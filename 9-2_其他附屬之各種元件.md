 9-2 其他附屬之各種元件

**專案名稱**：FreshLog (食價登錄)
**版本**：v1.0.0
**文件日期**：2025-10-27
**相關文件**：[9-1 元件清單及其規格描述](./9-1_元件清單及其規格描述.md)

---

## 目錄

1. [頁面級元件](#1-頁面級元件)
2. [API 服務模組](#2-api-服務模組)
3. [狀態管理模組](#3-狀態管理模組)
4. [路由系統](#4-路由系統)
5. [工具函式模組](#5-工具函式模組)
6. [資料模型與常數](#6-資料模型與常數)

---

## 1. 頁面級元件

頁面級元件 (Views) 是應用程式的完整頁面,負責組合多個元件並協調頁面邏輯。

### 1.1 會員系統頁面

#### 1.1.1 Login.vue

**路徑**: `src/views/Member/Login.vue`
**路由**: `/member/login`
**用途**: 會員登入頁面

##### 功能特性

1. **表單欄位**
   - 帳號輸入
   - 密碼輸入 (可切換顯示/隱藏)
   - 驗證碼輸入
   - 保持登入狀態選項

2. **驗證碼系統**
   - 從後端 API 載入驗證碼圖片
   - 支援 Base64 圖片格式
   - 點擊圖片重新載入
   - 可調整顯示寬度 (預設 110px)
   - 錯誤提示與重載機制

3. **登入流程**
   - 三欄必填驗證 (帳號+密碼+驗證碼)
   - 呼叫 `POST /api/user/login` API
   - 儲存 Token 至 localStorage
   - 更新 Pinia Store 登入狀態
   - 儲存 userId 與 userName
   - 登入後自動回跳至來源頁面

4. **第三方登入**
   - Google 登入按鈕 (UI 已完成,功能待整合)

5. **響應式設計**
   - 手機版調整內距與寬度
   - 保持兩側留白 (24px)

##### 主要狀態

| 狀態變數 | 型別 | 說明 |
|---------|------|------|
| `account` | `ref<string>` | 帳號 |
| `password` | `ref<string>` | 密碼 |
| `showPassword` | `ref<boolean>` | 密碼顯示/隱藏 |
| `captcha` | `ref<string>` | 驗證碼輸入 |
| `captchaImgUrl` | `ref<string>` | 驗證碼圖片 URL |
| `captchaError` | `ref<string>` | 驗證碼錯誤訊息 |

##### 計算屬性

| 計算屬性 | 回傳型別 | 說明 |
|---------|---------|------|
| `canSubmit` | `boolean` | 三欄皆填寫才可提交 |

##### 主要方法

| 方法名稱 | 參數 | 說明 |
|---------|------|------|
| `loadCaptcha()` | - | 載入驗證碼圖片 |
| `handleLogin()` | - | 處理登入邏輯 |
| `saveToken(raw)` | string | 儲存 JWT Token |

##### API 端點

- **取得驗證碼**: `GET /api/captcha/auth/captcha`
  - 回傳: Base64 圖片或 JSON `{ data: "<base64>" }`
- **登入**: `POST /api/user/login`
  - Body: `{ userName, userPassword, captcha }`
  - 回傳: `{ code, data: { token, userId, userName } }`

##### 樣式重點

- **卡片容器**: 白色背景,圓角 12px,陰影,最大寬度 370px
- **分頁標籤**: 綠色背景 + 底部綠線 (active 狀態)
- **輸入框**: 綠色邊框 2px,聚焦時淺綠背景
- **驗證碼圖片**: 高度 44px,綠色邊框,可點擊
- **提交按鈕**: 綠色背景,未滿足條件時灰色不可點擊

---

#### 1.1.2 Profile.vue

**路徑**: `src/views/Member/Profile.vue`
**路由**: `/member/profile`
**用途**: 會員中心主頁面

##### 功能特性

1. **左側選單**
   - 會員中心標題
   - 頭像顯示 (圓形,綠色邊框)
   - 四個功能選項:
     - 個人資訊
     - 食譜收藏
     - 蔬菜收藏
     - 到價追蹤
   - 登出按鈕 (紅色)

2. **個人資訊頁面**
   - 姓名、電話輸入
   - Email (唯讀,灰色禁用)
   - 偏好食譜類別下拉選單
   - 偏好蔬果類別下拉選單
   - 收貨地址輸入
   - 修改密碼連結
   - 儲存按鈕

3. **食譜收藏頁面**
   - 引用子元件 `Favorites.vue`
   - 顯示收藏的食譜清單
   - 支援分類篩選

4. **蔬菜收藏頁面**
   - 引用子元件 `VeggieFav.vue`
   - 顯示收藏的蔬菜清單
   - 支援分類篩選

5. **到價追蹤頁面**
   - 顯示「功能開發中」提示

6. **資料持久化**
   - 優先從 API 載入會員資料
   - 同步儲存至 localStorage (`userProfile_{userId}`)
   - API 失敗時使用 localStorage 快取
   - 偏好設定暫存於 localStorage (後端暫不支援)

7. **登入狀態檢查**
   - 未登入顯示「請先登入」卡片
   - 提供前往登入按鈕

##### 主要狀態

| 狀態變數 | 型別 | 說明 |
|---------|------|------|
| `activeTab` | `ref<string>` | 當前選中的標籤 |
| `isSaving` | `ref<boolean>` | 儲存中狀態 |
| `profileData` | `ref<object>` | 個人資料表單 |
| `favoritesRef` | `ref` | 食譜收藏元件引用 |
| `veggieFavRef` | `ref` | 蔬菜收藏元件引用 |

##### profileData 結構

```typescript
{
  name: string,                     // 姓名
  phone: string,                    // 電話
  email: string,                    // Email (唯讀)
  favoriteRecipeCategory: string,   // 偏好食譜類別
  favoriteFruitVeggieCategory: string, // 偏好蔬果類別
  address: string                   // 收貨地址
}
```

##### 計算屬性

| 計算屬性 | 回傳型別 | 說明 |
|---------|---------|------|
| `isLoggedIn` | `boolean` | 是否已登入 |
| `username` | `string` | 使用者名稱 |

##### 主要方法

| 方法名稱 | 參數 | 說明 |
|---------|------|------|
| `setActiveTab(tab)` | string | 切換標籤頁 |
| `loadUserData()` | - | 載入會員資料 |
| `updateProfile()` | - | 更新個人資料 |
| `handleLogout()` | - | 登出功能 |
| `getTabTitle()` | - | 取得標籤標題 |

##### API 端點

- **取得會員資料**: `GET /api/memberUser/find-information`
- **更新會員資料**: `POST /api/memberUser/update-information`

##### 樣式重點

- **左側選單**: 寬度 200px,淺綠背景 `#f0f8f0`
- **選單項目**: 垂直置中,active 時綠色背景,圓角 25px
- **右側內容區**: Flex 佈局,白色背景
- **登出按鈕**: 紅色背景 `#f44336`,Hover 深紅 `#d32f2f`
- **響應式**: 手機版改為垂直堆疊,單欄佈局

---

#### 1.1.3 Register.vue

**路徑**: `src/views/Member/Register.vue`
**路由**: `/member/register`
**用途**: 會員註冊頁面

##### 功能特性

- 註冊表單 (帳號、密碼、Email、驗證碼)
- 表單驗證
- 密碼強度檢查
- 重複密碼確認
- 與 Login.vue 類似的 UI 風格

---

#### 1.1.4 ForgotPassword.vue

**路徑**: `src/views/Member/ForgotPassword.vue`
**路由**: `/member/forgot-password`
**用途**: 忘記密碼頁面

##### 功能特性

- Email 輸入
- 發送重設密碼信件
- 驗證碼確認
- 設定新密碼

---

### 1.2 消費者頁面

#### 1.2.1 ConsumerHome.vue

**路徑**: `src/views/Consumer/ConsumerHome.vue`
**路由**: `/` (角色為 consumer 時)
**用途**: 消費者首頁儀表板

##### 功能特性

1. **Bento Box 佈局**
   - 使用 CSS Grid 16 欄系統
   - 桌機版:兩排佈局
   - 平板版 (769-1320px):三排佈局
   - 手機版:單欄 Flex 堆疊

2. **卡片元件引入**
   - BrandHeroCard (品牌主視覺)
   - MarketTrendCard (市場行情)
   - AgriCompositeIndexCard (農業指數)
   - RecipeListCard (食譜列表)
   - NutritionHelperCard (營養小幫手)
   - NewsCard (新聞動態)

3. **響應式佈局策略**
   - 桌機版:
     - Row 1: Brand (4/16) + Trend (8/16) + News (4/16)
     - Row 2: Agri (7/16) + Recipe (5/16) + Nutri (4/16)
   - 平板版:
     - Row 1: Brand (3/10) + Trend (7/10)
     - Row 2: Agri (7/10) + News (3/10)
     - Row 3: Recipe (5/10) + Nutri (5/10)
   - 手機版:
     - 使用 `order` 屬性控制順序
     - 全寬單欄顯示

##### 樣式重點

- **Grid 系統**: `grid-template-columns: repeat(16, minmax(0, 1fr))`
- **Grid 單位高度**: `grid-auto-rows: 24px`
- **間距**: 桌機 24px,平板 20px,手機 15px
- **最大寬度**: 1440px,自動置中
- **全寬技巧**: `width: 100vw; left: 50%; transform: translateX(-50%)`
- **卡片樣式** (使用 `:deep()`):
  - 白色背景,圓角 16px
  - 淺灰邊框 `#eef1f4`
  - 陰影 `0 2px 6px rgba(0,0,0,0.03)`

---

#### 1.2.2 RecipeListPage.vue

**路徑**: `src/views/Consumer/RecipeListPage.vue`
**路由**: `/recipes`
**用途**: 食譜列表頁面

##### 功能特性

1. **左側篩選側邊欄**
   - 引用 `RecipeFilterSidebar` 元件
   - 烹飪時間篩選
   - 難度篩選
   - 特色標籤篩選
   - Sticky 定位 (top: 20px)

2. **右側主要內容區**
   - 頁面標題「食譜推薦」
   - 排序下拉選單 (動態從 API 載入選項)
   - 分類標籤列 (引用 `RecipeCategoryTags`)
   - 食譜網格 (3 欄佈局)
   - 分頁控制
   - AI 智慧推薦區塊

3. **API 整合**
   - 呼叫 `POST /api/recipe/findRecipesList` 取得食譜列表
   - 呼叫 `GET /api/recipe/getRecipeSortEnums` 取得排序選項
   - 呼叫 `GET /api/recipe/getRecipeCategories` 取得分類選項
   - 支援分頁、篩選、排序

4. **篩選與排序**
   - 分類篩選:全部、湯品、蔬菜、甜點、沙拉、肉類、飯類
   - 烹飪時間:≤15分、≤30分、≤1小時
   - 難度:簡單、中等、困難
   - 特色:素食等
   - 排序:最新上架、烹調時間(升/降)、難易度(升/降)

5. **分頁系統**
   - 每頁 20 筆 (API 預設)
   - 顯示頁碼按鈕 (最多 7 個)
   - 上一頁/下一頁按鈕
   - 點擊後自動滾動至頂部

6. **響應式佈局**
   - 桌機版:左側側邊欄 (320px) + 右側內容區
   - 手機版:單欄堆疊,側邊欄移至下方

##### 主要狀態

| 狀態變數 | 型別 | 說明 |
|---------|------|------|
| `isLoading` | `ref<boolean>` | 載入狀態 |
| `allRecipes` | `ref<array>` | 食譜清單 |
| `filters` | `ref<object>` | 篩選條件 |
| `activeCategory` | `ref<string>` | 當前分類 |
| `currentSort` | `ref<string>` | 當前排序方式 |
| `currentPage` | `ref<number>` | 當前頁碼 |
| `totalElements` | `ref<number>` | 總資料筆數 |
| `totalPages` | `ref<number>` | 總頁數 |
| `sortOptions` | `ref<array>` | 排序選項清單 |
| `categoryOptions` | `ref<array>` | 分類選項清單 |

##### 計算屬性

| 計算屬性 | 回傳型別 | 說明 |
|---------|---------|------|
| `paginatedRecipes` | `array` | 當前頁面的食譜 (已由 API 分頁) |
| `displayPages` | `array` | 顯示的頁碼陣列 (最多 7 個) |
| `aiRecommendedRecipes` | `array` | AI 推薦食譜 (取前 3 筆) |

##### 主要方法

| 方法名稱 | 參數 | 說明 |
|---------|------|------|
| `loadRecipes()` | - | 從 API 載入食譜列表 |
| `loadSortOptions()` | - | 載入排序選項 |
| `loadCategoryOptions()` | - | 載入分類選項 |
| `updateFilters(newFilters)` | object | 更新篩選條件 |
| `handleCategoryChange(categoryId)` | string | 切換分類 |
| `handleSortChange()` | - | 切換排序方式 |
| `goToPage(page)` | number | 跳至指定頁碼 |
| `resetFilters()` | - | 重置篩選條件 |
| `getCategoryName(categoryId)` | string | 轉換分類 ID 為中文 |
| `getMaxCookMinutes()` | - | 取得烹飪時間上限 |
| `getDifficultyParam()` | - | 取得難度參數 |
| `getTagParam()` | - | 取得標籤參數 |

##### 樣式重點

- **側邊欄**: 寬度 320px,Sticky 定位
- **食譜網格**: `grid-template-columns: repeat(3, 1fr)`, 間距 24px
- **分頁按鈕**: 寬高 40px,綠色 Hover 效果
- **響應式斷點**:
  - ≤1400px: 側邊欄 300px, 2 欄網格
  - ≤1200px: 側邊欄 280px, 2 欄網格
  - ≤768px: 單欄堆疊,側邊欄移至下方

---

#### 1.2.3 VeggieInfoPage.vue

**路徑**: `src/views/Consumer/VeggieInfoPage.vue`
**路由**: `/veggie/:id`
**用途**: 蔬菜詳情頁面

##### 功能特性

- 顯示蔬菜詳細資訊
- 整合多個蔬菜相關元件 (VeggieMainInfoCard, AveragePriceTrendChart 等)
- 收藏功能
- 價格趨勢圖表
- 營養資訊
- 相關食譜推薦

---

#### 1.2.4 RecipeDetail.vue

**路徑**: `src/views/Consumer/RecipeDetail.vue`
**路由**: `/ai-recommendation/:id`
**用途**: 食譜詳情頁面

##### 功能特性

- 顯示食譜詳細資訊
- 整合多個食譜相關元件 (RecipeDetailHeader, IngredientsList 等)
- 收藏功能
- 料理步驟
- 營養成分
- 食材價格
- 替代食材建議

---

#### 1.2.5 AiRecommendation.vue

**路徑**: `src/views/Consumer/AiRecommendation.vue`
**路由**: `/ai-recommendation`
**用途**: AI 智慧推薦頁面

##### 功能特性

- AI 生成的食譜推薦
- 個人化推薦演算法
- 推薦食譜卡片列表

---

#### 1.2.6 FoodSafetyDetail.vue

**路徑**: `src/views/Consumer/FoodSafetyDetail.vue`
**路由**: `/foodsafety/:id`
**用途**: 食安資訊詳情頁面

##### 功能特性

- 顯示食安相關資訊
- 安全認證標章
- 檢驗報告
- 食安警示

---

### 1.3 農民頁面

#### 1.3.1 CropDashboard.vue

**路徑**: `src/views/Farmer/CropDashboard.vue`
**路由**: `/farmer/crop-dashboard`
**用途**: 農民作物管理儀表板

##### 功能特性

- 作物種植管理
- 產量統計
- 價格走勢
- 銷售紀錄
- 待完善功能

---

### 1.4 其他頁面

#### 1.4.1 Home.vue

**路徑**: `src/views/Home.vue`
**路由**: `/`
**用途**: 首頁路由器,根據角色導向不同頁面

##### 功能特性

- 判斷使用者角色 (consumer/farmer)
- Consumer → ConsumerHome.vue
- Farmer → FarmerHome.vue
- 預設為 Consumer

---

#### 1.4.2 RoleSelect.vue

**路徑**: `src/views/RoleSelect.vue`
**路由**: `/select-role`
**用途**: 角色選擇頁面

##### 功能特性

1. **全螢幕遮罩**
   - 半透明黑色背景 `rgba(0, 0, 0, 0.5)`
   - z-index: 10 (高於 Header)

2. **角色選擇按鈕**
   - 「我是消費者」按鈕
   - 「我是農民」按鈕
   - z-index: 20 (顯示在遮罩之上)

3. **選擇邏輯**
   - 點擊按鈕後儲存角色至 Pinia Store
   - 同步儲存至 localStorage (`userRole`)
   - 隱藏遮罩
   - 導向首頁 `/`

##### 主要狀態

| 狀態變數 | 型別 | 說明 |
|---------|------|------|
| `isOverlayVisible` | `ref<boolean>` | 遮罩顯示狀態 |

##### 主要方法

| 方法名稱 | 參數 | 說明 |
|---------|------|------|
| `selectRole(role)` | string | 選擇角色並導向首頁 |

##### 樣式重點

- **外層容器**: `height: 100vh`, Flex 垂直置中
- **遮罩層**: 絕對定位,全螢幕,半透明黑色
- **按鈕容器**: z-index: 20,置中對齊
- **標題**: 白色文字,24px

---

## 2. API 服務模組

API 服務模組負責封裝所有與後端的通訊邏輯,提供統一的介面供元件呼叫。

### 2.1 client.js

**路徑**: `src/api/client.js`
**用途**: Axios 客戶端配置與封裝

#### 功能特性

1. **Axios 實例配置**
   - Base URL: `https://freshlog-api.ttshow.tw` (可透過環境變數覆蓋)
   - Timeout: 30000ms (30 秒)
   - Headers: `Content-Type: application/json`, `Accept: application/json`

2. **Request Interceptor**
   - 自動注入 JWT Token (從 Pinia Store 取得)
   - Authorization Header: `Bearer {token}`
   - 開發模式下 Console 記錄請求資訊

3. **Response Interceptor**
   - 開發模式下 Console 記錄回應資訊
   - 錯誤處理:
     - 401: 自動登出,導向登入頁
     - 403: 無權限訪問
     - 404: 資源不存在
     - 500: 服務器錯誤
   - 網絡錯誤提示

4. **Request 方法封裝**
   - `get(url, params, config)`
   - `post(url, data, config)`
   - `put(url, data, config)`
   - `delete(url, params, config)`
   - `patch(url, data, config)`

#### 使用範例

```javascript
import { request } from '@/api/client'

// GET 請求
const data = await request.get('/api/users', { id: 123 })

// POST 請求
const result = await request.post('/api/login', { username, password })

// PUT 請求
await request.put('/api/users/123', { name: 'New Name' })

// DELETE 請求
await request.delete('/api/users/123')
```

#### 錯誤處理流程

```
Request Error → Console Error → Reject Promise
Response Error → Status Code 判斷 → 對應處理 → Reject Promise
  ├─ 401 → Logout → Redirect to Login
  ├─ 403 → Log Warning
  ├─ 404 → Log Error
  ├─ 500 → Log Error
  └─ Others → Log Error
Network Error → Console Error → Reject Promise
```

---

### 2.2 recipe.js

**路徑**: `src/api/recipe.js`
**用途**: 食譜相關 API

#### API 方法

##### 2.2.1 findRecipesList()

**用途**: 查詢食譜列表 (帶分頁與篩選)

**方法簽名**:

```javascript
findRecipesList(bodyParams = {}, queryParams = {})
```

**參數**:

| 參數名稱 | 位置 | 型別 | 說明 |
|---------|------|------|------|
| `category` | Body | string | 分類 (如「熱炒」) |
| `name` | Body | string | 名稱 (模糊搜尋) |
| `maxCookMinutes` | Body | number | 烹調時間上限 |
| `servings` | Body | string | 人數份量 |
| `difficulty` | Body | string | 難易度 |
| `tag` | Body | string | 標籤 (模糊搜尋) |
| `sort` | Body | string | 排序方式 (newest, cooktime_asc, etc.) |
| `pageNo` | Query | number | 頁碼 (0 起算) |
| `pageSize` | Query | number | 每頁筆數 (預設 20) |
| `sort` | Query | string/array | 排序條件 (格式: property,asc\|desc) |

**回傳格式**:

```json
{
  "code": "0000",
  "message": "搜尋成功",
  "data": {
    "pageNo": 0,
    "pageSize": 20,
    "totalElements": 100,
    "totalPages": 5,
    "content": [
      {
        "recipeId": "R001",
        "title": "番茄炒蛋",
        "description": "簡單美味的家常菜",
        "image": "/images/tomato-egg.jpg",
        "tag": "快炒,簡單",
        "cookTimeMinutes": 15,
        "servings": "2-3人份",
        "difficulty": "簡單",
        "createdAt": "2025-01-01T00:00:00Z"
      }
    ]
  }
}
```

##### 2.2.2 findRecipeData()

**用途**: 取得單一食譜詳細資料

**方法簽名**:

```javascript
findRecipeData(recipeId)
```

**參數**: `recipeId` (string) - 食譜 ID

##### 2.2.3 getRecipeSortEnums()

**用途**: 取得食譜排序選項列表

**方法簽名**:

```javascript
getRecipeSortEnums()
```

**回傳格式**:

```json
{
  "code": "0000",
  "message": "成功",
  "data": [
    { "code": "newest", "label": "最新上架" },
    { "code": "cooktime_asc", "label": "烹調時間由短到長" },
    { "code": "cooktime_desc", "label": "烹調時間由長到短" }
  ]
}
```

##### 2.2.4 getRecipeCategories()

**用途**: 取得食譜分類列表

**方法簽名**:

```javascript
getRecipeCategories()
```

**回傳格式**:

```json
{
  "code": "0000",
  "message": "成功",
  "data": ["湯品", "熱炒", "涼拌", "甜點", "主食"]
}
```

---

### 2.3 food.js

**路徑**: `src/api/food.js`
**用途**: 食材/蔬菜相關 API

#### API 方法

##### 2.3.1 findFoodsList()

**用途**: 查詢食材列表 (帶分頁與篩選)

**方法簽名**:

```javascript
findFoodsList(params = {}, pagination = {})
```

**參數**:

| 參數名稱 | 位置 | 型別 | 說明 |
|---------|------|------|------|
| `category` | Body | string | 分類 |
| `subCategory` | Body | string | 子分類 |
| `name` | Body | string | 名稱 |
| `nameEn` | Body | string | 英文名稱 |
| `priceMin` | Body | number | 最低價格 (預設 0) |
| `priceMax` | Body | number | 最高價格 (預設 999999) |
| `tag` | Body | string | 標籤 |
| `sort` | Body | string | 排序方式 (enum, 如 PRICE_DESC) |
| `pageNo` | Query | number | 頁碼 (0 起算) |
| `pageSize` | Query | number | 每頁筆數 (預設 20) |

**回傳格式**: 與 `findRecipesList` 類似

##### 2.3.2 findFoodData()

**用途**: 取得單一食材詳細資料

**方法簽名**:

```javascript
findFoodData(foodId)
```

##### 2.3.3 getFoodSortEnums()

**用途**: 取得食材排序選項列表

##### 2.3.4 getFoodSubCategories()

**用途**: 取得食材子分類列表

**方法簽名**:

```javascript
getFoodSubCategories(category)
```

---

### 2.4 favorite.js

**路徑**: `src/api/favorite.js`
**用途**: 收藏功能相關 API

#### API 方法

##### 食譜收藏

| 方法名稱 | HTTP | 端點 | 說明 |
|---------|------|------|------|
| `addRecipeFavorite(recipeId)` | POST | `/api/memberUser/favorites/recipe/{recipeId}` | 加入食譜收藏 |
| `removeRecipeFavorite(recipeId)` | DELETE | `/api/memberUser/favorites/recipe/{recipeId}` | 移除食譜收藏 |
| `getRecipeFavoriteList(category)` | GET | `/api/memberUser/favorites/recipe` | 取得收藏食譜清單 |
| `checkRecipeFavorite(recipeId)` | GET | `/api/favorite/recipe/check` | 檢查是否已收藏 |

##### 蔬菜收藏

| 方法名稱 | HTTP | 端點 | 說明 |
|---------|------|------|------|
| `addFoodFavorite(foodId)` | POST | `/api/memberUser/favorites/food/{foodId}` | 加入蔬菜收藏 |
| `removeFoodFavorite(foodId)` | DELETE | `/api/memberUser/favorites/food/{foodId}` | 移除蔬菜收藏 |
| `getFoodFavoriteList(subCategory)` | GET | `/api/memberUser/favorites/food` | 取得收藏蔬菜清單 |
| `checkFoodFavorite(foodId)` | GET | `/api/favorite/food/check` | 檢查是否已收藏 |

#### 回傳格式

**加入收藏回應**:

```json
{
  "code": "0000",
  "message": "收藏成功"
}
```

**收藏清單回應**:

```json
{
  "code": "0000",
  "message": "查詢成功",
  "data": {
    "items": [
      {
        "recipeId": "R001",
        "name": "番茄炒蛋",
        "category": "熱炒",
        "cookTimeMinutes": 15,
        "image": "/images/tomato-egg.jpg"
      }
    ]
  }
}
```

---

### 2.5 member.js

**路徑**: `src/api/member.js`
**用途**: 會員資料相關 API

#### API 方法

##### 2.5.1 getMemberInfo()

**用途**: 取得會員個人資訊

**方法簽名**:

```javascript
getMemberInfo()
```

**端點**: `GET /api/memberUser/find-information`

**回傳格式**:

```json
{
  "code": "0000",
  "message": "SUCCESS",
  "data": {
    "name": "張三",
    "phone": "0912345678",
    "email": "test@example.com",
    "favoriteRecipeCategory": "素食",
    "favoriteFruitVeggieCategory": "春季",
    "address": "台北市信義區..."
  }
}
```

##### 2.5.2 updateMemberInfo()

**用途**: 更新會員個人資訊

**方法簽名**:

```javascript
updateMemberInfo(data)
```

**端點**: `POST /api/memberUser/update-information`

**參數**:

```javascript
{
  name: string,                     // 姓名
  phone: string,                    // 電話
  address: string,                  // 地址
  favoriteRecipeCategory: string,   // 偏好食譜類別
  favoriteFruitVeggieCategory: string // 偏好蔬果類別
}
```

**回傳格式**:

```json
{
  "code": "0000",
  "message": "SUCCESS"
}
```

---

## 3. 狀態管理模組

### 3.1 user.js (Pinia Store)

**路徑**: `src/store/user.js`
**用途**: 使用者狀態管理

#### State

| 狀態變數 | 型別 | 預設值 | 說明 |
|---------|------|--------|------|
| `token` | string | localStorage 或 '' | JWT Token (原始格式,不含 Bearer) |
| `isAuthenticated` | boolean | 檢查 token + userId + userName | 是否已登入 |
| `userRole` | string | localStorage 或 'consumer' | 使用者角色 |
| `userId` | number | localStorage 或 null | 使用者 ID |
| `userName` | string | localStorage 或 '' | 使用者名稱 |
| `userInfo` | object | {} | 其他使用者資訊 |

#### Getters

| Getter 名稱 | 回傳型別 | 說明 |
|-----------|---------|------|
| `authHeader` | string | Authorization Header (格式: `Bearer {token}`) |

#### Actions

##### 3.1.1 setToken()

**用途**: 設定 JWT Token

**方法簽名**:

```javascript
setToken(token)
```

**功能**:
- 儲存 Token 至 state
- 同步儲存至 localStorage (`userToken`)
- 更新 `isAuthenticated` 狀態

##### 3.1.2 setIsAuthenticated()

**用途**: 設定登入狀態

**方法簽名**:

```javascript
setIsAuthenticated(status)
```

**功能**:
- 更新 `isAuthenticated`
- 若為 false,清空 Token

##### 3.1.3 setUserRole()

**用途**: 設定使用者角色

**方法簽名**:

```javascript
setUserRole(role)
```

**功能**:
- 更新 `userRole` (consumer/farmer)
- 同步儲存至 localStorage (`userRole`)

##### 3.1.4 setUserId()

**用途**: 設定使用者 ID

**方法簽名**:

```javascript
setUserId(id)
```

**功能**:
- 更新 `userId`
- 同步儲存至 localStorage (`userId`)

##### 3.1.5 setUserName()

**用途**: 設定使用者名稱

**方法簽名**:

```javascript
setUserName(name)
```

**功能**:
- 更新 `userName`
- 同步儲存至 localStorage (`userName`)

##### 3.1.6 setUserInfo()

**用途**: 設定使用者額外資訊

**方法簽名**:

```javascript
setUserInfo(info)
```

##### 3.1.7 logout()

**用途**: 登出

**方法簽名**:

```javascript
logout()
```

**功能**:
- 清空 Token
- 清空 userId
- 清空 userName
- 清空 userInfo
- 移除 localStorage 相關資料

#### 使用範例

```javascript
import { useUserStore } from '@/store/user'

const userStore = useUserStore()

// 登入
userStore.setToken('eyJhbGciOiJIUzI1...')
userStore.setUserId(123)
userStore.setUserName('張三')
userStore.setUserRole('consumer')
userStore.setIsAuthenticated(true)

// 檢查登入狀態
if (userStore.isAuthenticated) {
  console.log('已登入')
}

// 取得 Authorization Header
const authHeader = userStore.authHeader
// => "Bearer eyJhbGciOiJIUzI1..."

// 登出
userStore.logout()
```

---

## 4. 路由系統

### 4.1 router/index.js

**路徑**: `src/router/index.js`
**用途**: Vue Router 路由配置

#### 路由表

| 路徑 | 名稱 | 元件 | 說明 | 需登入 |
|-----|------|------|------|--------|
| `/` | Home | Home.vue | 首頁 (角色判斷) | ✗ |
| `/select-role` | - | RoleSelect.vue | 角色選擇 | ✗ |
| `/recipes` | RecipeList | RecipeListPage.vue | 食譜列表 | ✗ |
| `/veggie` | - | Redirect to `/veggie/F001` | 蔬菜預設 | ✗ |
| `/veggie/:id` | VeggieInfo | VeggieInfoPage.vue | 蔬菜內頁 | ✗ |
| `/foodsafety/:id` | - | FoodSafetyDetail.vue | 食安內頁 | ✗ |
| `/ai-recommendation` | - | AiRecommendation.vue | AI 推薦 | ✗ |
| `/ai-recommendation/:id` | RecipeDetail | RecipeDetail.vue | 食譜內頁 | ✗ |
| `/farmer/crop-dashboard` | - | CropDashboard.vue | 農民儀表板 | ✓ |
| `/member/login` | - | Login.vue | 登入 | ✗ |
| `/member/register` | - | Register.vue | 註冊 | ✗ |
| `/member/forgot-password` | - | ForgotPassword.vue | 忘記密碼 | ✗ |
| `/member/profile` | - | Profile.vue | 個人資訊 | ✓ |
| `/member/follows` | - | MyFollows.vue | 我的追蹤 | ✓ |
| `/member/follow-setting` | - | FollowSetting.vue | 追蹤設定 | ✓ |

#### 路由模式

- **History Mode**: `createWebHistory()`
- **優點**: URL 乾淨,無 `#` 符號
- **注意**: 需要後端配合配置 (Vercel 已透過 `vercel.json` 設定)

#### 路由守衛 (beforeEach)

**保護路徑**:

```javascript
const protectedPaths = [
  "/member/profile",
  "/member/follows",
  "/member/follow-setting",
  "/farmer/crop-dashboard",
]
```

**守衛邏輯**:

```
1. 檢查登入狀態:
   - 需要 token + userId + userName 三者皆存在

2. 判斷是否為登入/註冊頁:
   - 是 → 記錄來源路徑至 redirectAfterLogin

3. 判斷是否為受保護路徑:
   - 是 + 未登入 → 記錄目標路徑,導向登入頁
   - 否 → 通過
```

**redirectAfterLogin 機制**:

```javascript
// 儲存來源路徑
localStorage.setItem('redirectAfterLogin', to.fullPath)

// 登入後讀取並導向
const redirectPath = localStorage.getItem('redirectAfterLogin')
if (redirectPath) {
  localStorage.removeItem('redirectAfterLogin')
  router.push(redirectPath)
} else {
  router.push('/') // 預設導向首頁
}
```

---

## 5. 工具函式模組

### 5.1 resolveImg.js

**路徑**: `src/utils/resolveImg.js`
**用途**: 統一處理圖片路徑解析

#### 功能說明

處理三種圖片路徑格式:

1. **絕對 URL** (http/https): 直接回傳
2. **以 `/assets` 開頭**: 使用 Vite 的 `new URL()` 引入
3. **其他相對路徑**: 嘗試從 `@/assets/` 引入,失敗則回傳原路徑

#### 實作邏輯

```javascript
export function resolveImg(path) {
  if (!path) return ''

  // 絕對 URL
  if (path.startsWith('http://') || path.startsWith('https://')) {
    return path
  }

  // 以 /assets 開頭
  if (path.startsWith('/assets')) {
    return new URL(`..${path}`, import.meta.url).href
  }

  // 嘗試從 @/assets/ 引入
  try {
    return new URL(`../assets/${path}`, import.meta.url).href
  } catch {
    return path
  }
}
```

#### 全域註冊

**位置**: `src/main.js`

```javascript
import { resolveImg } from '@/utils/resolveImg'

app.config.globalProperties.$img = resolveImg
```

#### 使用範例

```vue
<template>
  <!-- 相對路徑 -->
  <img :src="$img('logo.png')" alt="Logo" />

  <!-- 絕對路徑 -->
  <img :src="$img('https://example.com/image.jpg')" alt="External" />

  <!-- /assets 路徑 -->
  <img :src="$img('/assets/icons/heart.png')" alt="Heart" />
</template>
```

---

### 5.2 role.js

**路徑**: `src/utils/role.js`
**用途**: 角色相關工具函式

#### 功能說明

提供角色判斷、角色切換等輔助函式 (具體實作待確認)

---

## 6. 資料模型與常數

### 6.1 搜尋索引資料

**路徑**: `src/data/searchIndex.js`
**用途**: 提供 Header 搜尋功能的資料索引

#### 資料結構

```javascript
export default {
  veggies: [
    {
      id: 'F001',
      name: '番茄',
      aliases: ['tomato', '蕃茄', '西紅柿']
    },
    // ...更多蔬菜
  ],
  recipes: [
    {
      id: 'R001',
      name: '番茄炒蛋',
      aliases: ['tomato egg', '蕃茄炒蛋']
    },
    // ...更多食譜
  ]
}
```

#### 用途

- Header 搜尋自動完成
- 支援中英文搜尋
- 支援別名搜尋

---

### 6.2 儀表板資料

**路徑**: `src/data/consumerDashboardData.js`
**用途**: 消費者首頁儀表板的模擬資料

#### 資料內容

```javascript
export const marketTrend = {
  unit: '公斤',
  items: ['番茄', '高麗菜', '青江菜', '空心菜'],
  last7days: [
    { date: '01/20', 番茄: 45, 高麗菜: 30, 青江菜: 25, 空心菜: 20 },
    { date: '01/21', 番茄: 47, 高麗菜: 32, 青江菜: 24, 空心菜: 21 },
    // ...更多日期
  ]
}
```

---

### 6.3 價格趨勢資料

**路徑**: `src/data/priceTrendData.js`
**用途**: 蔬菜價格趨勢模擬資料

#### 資料結構

```javascript
export const priceTrendData = {
  '30days': [
    { date: '2025-01-01', price: 45 },
    { date: '2025-01-02', price: 47 },
    // ...30 天資料
  ]
}
```

---

### 6.4 營養資料

**路徑**: `src/data/nutritionData.js`
**用途**: 蔬菜營養成分參考資料

---

### 6.5 食譜列表資料

**路徑**: `src/data/6424/RecipeListData/RecipeListData.js`
**用途**: 食譜列表頁面的篩選選項與模擬資料

#### 篩選選項結構

```javascript
export const filterOptions = {
  cookTime: [
    { id: '15min', label: '15分鐘內', checked: false },
    { id: '30min', label: '30分鐘內', checked: false },
    { id: '1hour', label: '1小時內', checked: false }
  ],
  difficulty: [
    { id: 'easy', label: '簡單', checked: false },
    { id: 'medium', label: '中等', checked: false },
    { id: 'hard', label: '困難', checked: false }
  ],
  features: [
    { id: 'all', label: '全部', checked: true },
    { id: 'vegetarian', label: '素食', checked: false }
  ]
}

export const categoryTags = [
  { id: 'all', label: '全部' },
  { id: 'soup', label: '湯品' },
  { id: 'vegetable', label: '蔬菜' },
  { id: 'dessert', label: '甜點' },
  { id: 'salad', label: '沙拉' }
]
```

---

## 7. 開發與建置腳本

### 7.1 package.json scripts

| 指令 | 說明 |
|-----|------|
| `npm run dev` | 啟動開發伺服器 (Vite) |
| `npm run build` | 建置生產版本 |
| `npm run preview` | 預覽建置結果 |
| `npm run mock` | 啟動 Mock 伺服器 (Express) |

---

## 8. 部署配置

### 8.1 vercel.json

**路徑**: `vercel.json`
**用途**: Vercel 部署配置

#### 配置內容

```json
{
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
```

**功能**:
- 支援 SPA 路由
- 所有路徑重寫至 `index.html`
- 避免刷新頁面出現 404 錯誤

---

## 9. 環境配置

### 9.1 .env

**路徑**: `.env`

```env
VITE_API_BASE_URL=https://freshlog-api.ttshow.tw
VITE_ASSET_BASE=https://freshlog-api.ttshow.tw
```

### 9.2 vite.config.js

**路徑**: `vite.config.js`

```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import path from 'path'

export default defineConfig({
  plugins: [vue()],
  base: '/',
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    }
  },
  server: {
    proxy: {
      '/api': {
        target: 'https://freshlog-api.ttshow.tw',
        changeOrigin: true
      }
    }
  }
})
```

**功能**:
- Vue SFC 支援
- 路徑別名 `@` → `./src`
- API 代理至後端伺服器

---

## 10. 附錄

### 10.1 檔案結構總覽

```
src/
├── api/                    # API 服務模組
│   ├── client.js          # Axios 客戶端
│   ├── recipe.js          # 食譜 API
│   ├── food.js            # 食材 API
│   ├── favorite.js        # 收藏 API
│   ├── member.js          # 會員 API
│   └── index.js           # API 匯出
├── assets/                # 靜態資源
│   ├── icons/             # 圖示
│   ├── recipe/            # 食譜圖片
│   ├── style.css          # 全域樣式
│   └── logo.png           # Logo
├── components/            # 元件 (詳見 9-1)
├── data/                  # 模擬資料
│   ├── searchIndex.js     # 搜尋索引
│   ├── consumerDashboardData.js # 儀表板資料
│   ├── priceTrendData.js  # 價格趨勢
│   ├── nutritionData.js   # 營養資料
│   └── 6424/              # 學習資料
├── router/                # 路由
│   └── index.js           # 路由配置
├── store/                 # 狀態管理
│   └── user.js            # User Store
├── utils/                 # 工具函式
│   ├── resolveImg.js      # 圖片路徑解析
│   └── role.js            # 角色工具
├── views/                 # 頁面元件
│   ├── Consumer/          # 消費者頁面
│   ├── Farmer/            # 農民頁面
│   ├── Member/            # 會員頁面
│   ├── Home.vue           # 首頁路由器
│   └── RoleSelect.vue     # 角色選擇
├── App.vue                # 根元件
└── main.js                # 入口檔案
```

### 10.2 API 端點總覽

#### 食譜相關

| 端點 | 方法 | 說明 |
|-----|------|------|
| `/api/recipe/findRecipesList` | POST | 查詢食譜列表 |
| `/api/recipe/findRecipeData` | GET | 取得食譜詳情 |
| `/api/recipe/getRecipeSortEnums` | GET | 取得排序選項 |
| `/api/recipe/getRecipeCategories` | GET | 取得分類選項 |

#### 食材相關

| 端點 | 方法 | 說明 |
|-----|------|------|
| `/api/food/findFoodsList` | POST | 查詢食材列表 |
| `/api/food/findFoodData` | GET | 取得食材詳情 |
| `/api/food/getFoodSortEnums` | GET | 取得排序選項 |
| `/api/food/getFoodSubCategories` | GET | 取得子分類 |

#### 收藏相關

| 端點 | 方法 | 說明 |
|-----|------|------|
| `/api/memberUser/favorites/recipe/{id}` | POST | 加入食譜收藏 |
| `/api/memberUser/favorites/recipe/{id}` | DELETE | 移除食譜收藏 |
| `/api/memberUser/favorites/recipe` | GET | 查詢食譜收藏清單 |
| `/api/memberUser/favorites/food/{id}` | POST | 加入蔬菜收藏 |
| `/api/memberUser/favorites/food/{id}` | DELETE | 移除蔬菜收藏 |
| `/api/memberUser/favorites/food` | GET | 查詢蔬菜收藏清單 |

#### 會員相關

| 端點 | 方法 | 說明 |
|-----|------|------|
| `/api/user/login` | POST | 登入 |
| `/api/captcha/auth/captcha` | GET | 取得驗證碼 |
| `/api/memberUser/find-information` | GET | 取得會員資料 |
| `/api/memberUser/update-information` | POST | 更新會員資料 |

### 10.3 localStorage 使用清單

| Key | 型別 | 說明 |
|-----|------|------|
| `userToken` | string | JWT Token (原始格式) |
| `userId` | string | 使用者 ID |
| `userName` | string | 使用者名稱 |
| `userRole` | string | 使用者角色 (consumer/farmer) |
| `redirectAfterLogin` | string | 登入後回跳路徑 |
| `userProfile_{userId}` | JSON string | 會員個人資料快取 |

### 10.4 Pinia Store 使用清單

| Store 名稱 | 檔案 | 用途 |
|-----------|------|------|
| `user` | `store/user.js` | 使用者登入狀態與資料 |

### 10.5 全域屬性清單

| 屬性名稱 | 型別 | 說明 |
|---------|------|------|
| `$img` | Function | 圖片路徑解析函式 |

### 10.6 常用色彩變數

雖然專案未使用 CSS 變數,但以下為常用色彩參考:

| 用途 | 色碼 | 說明 |
|-----|------|------|
| 主綠色 | `#2e7d32` | 按鈕、連結、主色調 |
| 淺綠色 | `#f0f8f0` | 背景、Hover 狀態 |
| 深綠色 | `#27682b` | 按鈕 Hover |
| 紅色 | `#f44336` | 登出按鈕 |
| 橘色 | `#ff9800` | 價格標籤 |
| 灰色 | `#f8f9fa` | 頁面背景 |

---

## 11. 開發規範與最佳實踐

### 11.1 元件開發規範

1. **檔案命名**: PascalCase (如 `RecipeCard.vue`)
2. **Props 定義**: 使用 `defineProps` 並明確型別
3. **Emits 定義**: 使用 `defineEmits` 宣告事件
4. **Ref 命名**: 小寫駝峰 (如 `isLoading`)
5. **計算屬性**: 小寫駝峰 (如 `filteredRecipes`)
6. **方法命名**: 小寫駝峰,動詞開頭 (如 `handleClick`)

### 11.2 API 呼叫規範

1. **集中管理**: 所有 API 呼叫透過 `src/api/` 模組
2. **錯誤處理**: 使用 try-catch 包裹
3. **Loading 狀態**: 呼叫前設為 true,完成後設為 false (finally)
4. **回應碼檢查**: 檢查 `code === '0000'` 判斷成功
5. **使用者提示**: 成功/失敗皆給予明確提示 (alert 或 UI 元件)

### 11.3 狀態管理規範

1. **優先使用 Pinia**: 跨元件狀態使用 Pinia Store
2. **元件內狀態**: 僅元件內使用的狀態用 `ref`/`reactive`
3. **避免重複狀態**: 相同狀態不應同時存在多處
4. **localStorage 同步**: 需要持久化的狀態同步至 localStorage

### 11.4 樣式規範

1. **Scoped Styles**: 元件樣式使用 `<style scoped>`
2. **命名**: kebab-case (如 `recipe-card`)
3. **BEM 慣例**: 可選,建議用於複雜元件
4. **響應式**: 使用 `@media` 查詢,斷點統一為 768px
5. **避免 !important**: 除非必要,否則不使用

### 11.5 程式碼品質

1. **Console 清理**: 生產版本移除 `console.log`
2. **註解**: 複雜邏輯加上中文註解
3. **魔術數字**: 使用常數取代 (如 `const PAGE_SIZE = 20`)
4. **DRY 原則**: 避免重複程式碼,抽取共用函式

---

## 12. 更新記錄

| 版本 | 日期 | 更新內容 |
|-----|------|---------|
| v1.0.0 | 2025-10-27 | 初版完成,包含頁面元件、API 模組、狀態管理、路由系統等完整文件 |

---

**文件結束**

**相關文件**:
- [9-1 元件清單及其規格描述](./9-1_元件清單及其規格描述.md)
#