%%{init: {'theme':'base', 'themeVariables': {'primaryColor':'#E3F2FD','primaryTextColor':'#000','primaryBorderColor':'#1976D2','fontSize':'15px','fontFamily':'Arial, Microsoft YaHei'}}}%%

flowchart TB
    Start([開始]) --> Home[進入FreshLog首頁]
    Home --> Choose{選擇功能模組}

    %% 蔬菜模組
    Choose -->|蔬菜瀏覽| V1[蔬菜列表頁]
    V1 --> V2>篩選: 分類/價格/營養/特色/名稱]
    V2 --> V3[選擇排序方式]
    V3 --> V4[載入並顯示卡片]
    V4 --> V5{需要翻頁?}
    V5 -->|是| V4
    V5 -->|否| V6{查看詳情?}
    V6 -->|是| V7[蔬菜詳細頁]
    V7 --> V8{已登入?}
    V8 -->|是| V9{操作選擇}
    V9 -->|收藏| V10[加入收藏]
    V9 -->|價格追蹤| V11[設定追蹤]
    V9 -->|查看食譜| RecipeDetail
    V10 --> VEnd
    V11 --> VEnd
    V8 -->|否| V12[提示登入]
    V12 --> V13{前往登入?}
    V13 -->|是| LoginPage
    V13 -->|否| VEnd
    V6 -->|否| VEnd
    VEnd[返回] --> EndPoint

    %% 食譜模組
    Choose -->|食譜查詢| R1[食譜列表頁]
    R1 --> R2>篩選: 時間/難度/特色/分類/名稱]
    R2 --> R3[選擇排序方式]
    R3 --> R4[載入並顯示列表]
    R4 --> R5{需要翻頁?}
    R5 -->|是| R4
    R5 -->|否| R6{查看詳情?}
    R6 -->|是| RecipeDetail[食譜詳細頁]
    RecipeDetail --> R8{已登入?}
    R8 -->|是| R9{收藏食譜?}
    R9 -->|是| R10[加入收藏]
    R9 -->|否| R11{查看相關?}
    R10 --> R11
    R11 -->|是| RecipeDetail
    R11 -->|否| REnd
    R8 -->|否| R12[提示登入]
    R12 --> R11
    R6 -->|否| REnd
    REnd[返回] --> EndPoint

    %% 會員模組
    Choose -->|會員功能| M1{已登入?}
    M1 -->|否| LoginPage[登入頁面]
    LoginPage --> M2{登入方式}

    M2 -->|一般登入| M3[輸入帳號密碼驗證碼]
    M3 --> M4{驗證成功?}
    M4 -->|是| M5[登入成功]
    M4 -->|否| M6{忘記密碼?}
    M6 -->|是| M7[重設密碼流程]
    M7 --> LoginPage
    M6 -->|否| M3

    M2 -->|Google OAuth| M8[OAuth授權]
    M8 --> M9{認證成功?}
    M9 -->|是| M5
    M9 -->|否| End1([結束])

    M2 -->|註冊| M10[註冊頁面]
    M10 --> M11[填寫資料]
    M11 --> M12{驗證成功?}
    M12 -->|是| M13[建立帳號]
    M13 --> LoginPage
    M12 -->|否| M11

    M1 -->|是| M5
    M5 --> M14{進入會員中心?}

    M14 -->|是| M15[個人資料管理]
    M15 --> M16{功能標籤}
    M16 -->|個人資訊| M17[編輯資訊]
    M16 -->|食譜收藏| M18[管理食譜收藏]
    M16 -->|蔬菜收藏| M19[管理蔬菜收藏]
    M16 -->|到價追蹤| M20[管理追蹤清單]
    M17 --> MEnd
    M18 --> MEnd
    M19 --> MEnd
    M20 --> MEnd

    M14 -->|否| M21{設定追蹤偏好?}
    M21 -->|是| M22>設定: 通知/門檻/方式]
    M22 --> M23[儲存設定]
    M23 --> MEnd
    M21 -->|否| MEnd
    MEnd[返回] --> EndPoint

    %% 市場資訊模組
    Choose -->|市場資訊| K1{查詢類型}
    K1 -->|食安快訊| K2[快訊列表]
    K2 --> K3[查看詳細資訊]
    K1 -->|禽產行情| K4[禽產市場-開發中]
    K1 -->|海產行情| K5[海產市場-開發中]
    K3 --> KEnd
    K4 --> KEnd
    K5 --> KEnd
    KEnd[返回] --> EndPoint

    EndPoint([結束])

    %% 樣式定義
    classDef startEnd fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff,font-size:15px
    classDef decision fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,font-size:15px
    classDef process fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,font-size:15px
    classDef parallel fill:#FCE4EC,stroke:#C2185B,stroke-width:2px,font-size:15px
    classDef important fill:#FFEBEE,stroke:#D32F2F,stroke-width:2px,font-size:15px

    class Start,EndPoint,End1 startEnd
    class Choose,V5,V6,V8,V9,V13,R5,R6,R8,R9,R11,M1,M2,M4,M6,M9,M12,M14,M16,M21,K1 decision
    class V2,R2,M22 parallel
    class LoginPage,M5,V7,RecipeDetail,M15 important
