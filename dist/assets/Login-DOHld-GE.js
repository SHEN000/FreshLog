import{_ as N,u as V,r as l,i as D,h as G,c as f,o as w,b as o,j as y,D as h,m as j,E,k,G as Q,H as C,a as Y,I as K,n as H,t as M,y as r,d as q}from"./index-DmGRutL1.js";import{_ as X}from"./logo-CqOTfE4X.js";const F="data:image/png;base64,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",Z={class:"auth-page"},z={class:"auth-card"},J={class:"tabs"},O={class:"form-group"},_={class:"input-container"},$={class:"form-group"},tt={class:"input-container"},et=["type"],ot={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},st={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},at={class:"form-group"},nt={class:"captcha-row"},it={class:"input-container captcha-input"},lt=["onKeydown"],rt=["src"],ct={key:0,class:"captcha-error"},dt={class:"extra-options"},ut=["disabled"],mt={class:"join-text"},pt={__name:"Login",setup(vt){const i=V(),B=q(),u=l(""),m=l(""),p=l(!1),c=l(""),v=l(""),d=l(""),P=l("110px"),I="".replace(/\/$/,"");async function T(a){return fetch(`${I}${a}`,{credentials:"include"})}async function W(a,e){const s=await fetch(`${I}${a}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(e)}),t=await s.text(),n=t?JSON.parse(t):{};if(!s.ok)throw new Error((n==null?void 0:n.message)||`HTTP ${s.status}`);return n}async function b(){try{d.value="";const a=await T("/api/captcha/auth/captcha");if((a.headers.get("content-type")||"").includes("application/json")){const s=await a.json(),t=(s==null?void 0:s.data)||(s==null?void 0:s.captcha)||(s==null?void 0:s.image)||(s==null?void 0:s.base64)||Object.values(s).find(n=>typeof n=="string");if(!t)throw new Error("驗證碼格式不正確");v.value=t.startsWith("data:image")?t:`data:image/png;base64,${t}`}else{const s=await a.blob();v.value=URL.createObjectURL(s)}}catch(a){console.error(a),v.value="",d.value="驗證碼載入失敗，請點圖重新載入"}}D(b);const S=G(()=>u.value.trim()!==""&&m.value.trim()!==""&&c.value.trim()!=="");async function L(){var a,e,s;if(S.value){d.value="";try{const t=await W("/api/user/login",{userName:u.value.trim(),userPassword:m.value,captcha:c.value.trim()}),n=`${(t==null?void 0:t.code)??""}`;if(!(!n||n==="6001"||/^2/.test(n)||(t==null?void 0:t.success)===!0))throw new Error((t==null?void 0:t.message)||"登入失敗");const R=((a=t==null?void 0:t.data)==null?void 0:a.token)??(t==null?void 0:t.token);if(!R)throw new Error("登入回應缺少 token");i.setToken(String(R));const g=((e=t==null?void 0:t.data)==null?void 0:e.userId)??(t==null?void 0:t.userId),A=((s=t==null?void 0:t.data)==null?void 0:s.userName)??(t==null?void 0:t.userName);g!=null&&(localStorage.setItem("userId",String(g)),typeof i.setUserId=="function"?i.setUserId(g):i.userId=g),A&&(localStorage.setItem("userName",String(A)),typeof i.setUserName=="function"?i.setUserName(A):i.userName=A);const x=localStorage.getItem("userRole")||"consumer";i.setUserRole(x),i.setIsAuthenticated(!0);const U=localStorage.getItem("redirectAfterLogin");U?(localStorage.removeItem("redirectAfterLogin"),B.push(U)):B.push(x==="farmer"?"/farmer/crop-dashboard":"/veggie")}catch(t){alert(t.message||"登入失敗，請重試"),c.value="",await b()}}}return(a,e)=>{const s=j("RouterLink");return w(),f("div",Z,[o("div",z,[e[15]||(e[15]=o("div",{class:"logo-section"},[o("img",{src:X,alt:"Logo",class:"logo"}),o("h1",null,"登入食價登錄FRESHLOG")],-1)),o("div",J,[e[5]||(e[5]=o("button",{class:"tab active"},"登入",-1)),y(s,{to:"/member/register",class:"tab"},{default:h(()=>e[4]||(e[4]=[r("註冊")])),_:1})]),o("form",{onSubmit:E(L,["prevent"]),class:"form"},[o("div",O,[o("div",_,[k(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),placeholder:"帳號"},null,512),[[Q,u.value]])])]),o("div",$,[o("div",tt,[k(o("input",{type:p.value?"text":"password","onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),placeholder:"密碼"},null,8,et),[[C,m.value]]),o("span",{class:"toggle-password",onClick:e[2]||(e[2]=t=>p.value=!p.value)},[p.value?(w(),f("svg",ot,e[6]||(e[6]=[o("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"},null,-1),o("circle",{cx:"12",cy:"12",r:"3"},null,-1)]))):(w(),f("svg",st,e[7]||(e[7]=[o("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 20c-5.05 0-9.29-3.18-11-8a10.94 10.94 0 0 1 5.06-6.26M1 1l22 22"},null,-1)])))])])]),o("div",at,[o("div",nt,[o("div",it,[k(o("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>c.value=t),placeholder:"輸入驗證碼",maxlength:"6",onKeydown:K(E(L,["prevent"]),["enter"])},null,40,lt),[[Q,c.value]])]),o("img",{src:v.value,class:"captcha-img",alt:"驗證碼",title:"看不清？點擊更換",onClick:b,draggable:"false",style:H({width:P.value})},null,12,rt)]),d.value?(w(),f("p",ct,M(d.value),1)):Y("",!0)]),o("div",dt,[e[9]||(e[9]=o("label",null,[o("input",{type:"checkbox"}),r(" 保持登入狀態")],-1)),y(s,{to:"/member/forgot-password",class:"forgot"},{default:h(()=>e[8]||(e[8]=[r("忘記密碼？")])),_:1})]),o("button",{type:"submit",class:"submit-btn",disabled:!S.value},"登入 蔬界！",8,ut),o("p",mt,[e[11]||(e[11]=r(" 不是會員？")),y(s,{to:"/member/register"},{default:h(()=>e[10]||(e[10]=[r("快來加入我們的蔬菜大家庭🍅")])),_:1})]),e[12]||(e[12]=o("div",{class:"join-divider"},null,-1)),e[13]||(e[13]=o("div",{class:"divider"},"或者，如果您使用 Google 建立帳號",-1)),e[14]||(e[14]=o("button",{class:"google-btn"},[o("img",{src:F,alt:"Google"}),r(" 繼續使用Google ")],-1))],32)])])}}},wt=N(pt,[["__scopeId","data-v-69139143"]]);export{wt as default};
