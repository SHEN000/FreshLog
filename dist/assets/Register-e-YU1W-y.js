import{_ as Y,u as ee,r as n,h as u,J as te,c as a,o as l,b as t,j as E,D as N,m as se,E as oe,a as p,k as f,G as A,F as ae,t as le,y as _,K as ne,H as j,d as re}from"./index-DZTT0LQi.js";import{_ as ie}from"./logo-CqOTfE4X.js";const ue={class:"auth-page"},de={class:"auth-card"},ce={class:"tabs"},ve={key:0},me={class:"form-group"},pe={class:"input-container"},ge={key:0,class:"input-error"},fe={class:"form-group"},_e=["disabled"],we={class:"timer"},ye={class:"form-group horizontal-group"},he={class:"input-container"},be=["disabled"],ke={key:0,class:"input-error"},xe={class:"form-group"},Se={class:"terms"},Ce={class:"form-group"},Ve=["disabled"],Pe={key:1},Re={class:"form-group"},Ie={class:"input-container"},Me={key:0,class:"input-error"},Ae={key:1,class:"input-error"},$e={class:"form-group"},ze={class:"input-container password-input-container"},Be=["type"],Ue={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Le={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Te={key:0,class:"input-error"},Ee={class:"form-group"},Ne={class:"input-container password-input-container"},je=["type"],De={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},qe={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Fe={key:0,class:"input-error"},He={class:"form-group"},Oe=["disabled"],Ge={class:"join-text"},Je={__name:"Register",setup(Ze){const D=ee(),V=re(),q="",g=n(1),v=n(""),d=n(""),P=n(!1),R=n(!1),b=n(60);let w=null;const r=n(!1),F=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,I=u(()=>F.test(v.value.trim())),H=u(()=>d.value.trim().length===6),c=n(""),m=n(""),y=n(""),k=n(!1),x=n(!1),$=/^[A-Za-z0-9]+$/,O=u(()=>{const s=c.value.trim();return s.length>=8&&$.test(s)}),G=/^(?=.*[A-Za-z])(?=.*\d).{8,}$/,z=u(()=>G.test(m.value)),B=u(()=>y.value===m.value),J=u(()=>I.value&&!r.value),Z=u(()=>g.value===1&&!r.value),U=u(()=>g.value===1&&d.value.trim().length===6&&P.value&&!r.value),L=u(()=>g.value===2&&O.value&&z.value&&B.value&&!r.value);function K(){clearInterval(w),b.value=300,w=setInterval(()=>{b.value>0?b.value--:clearInterval(w)},1e3)}te(()=>clearInterval(w));async function M(s,{query:e,body:i}={}){const o=e?"?"+new URLSearchParams(e).toString():"",S=`${q}${s}${o}`,h=await fetch(S,{method:"POST",headers:i?{"Content-Type":"application/json"}:void 0,body:i?JSON.stringify(i):void 0}),C=await h.json().catch(()=>({}));if(!h.ok)throw new Error((C==null?void 0:C.message)||`HTTP ${h.status}`);return C}async function T(){if(I.value){r.value=!0;try{const s=await M("/api/user/send-register-code",{query:{email:v.value.trim()}});if(String((s==null?void 0:s.code)??"")==="6006"){alert((s==null?void 0:s.message)||"電子郵件已被註冊，請改用其他信箱或直接登入");return}R.value=!0,K()}catch(s){alert(s.message||"發送驗證碼失敗，請稍後再試")}finally{r.value=!1}}}async function Q(){d.value="",await T()}async function W(){if(U.value){r.value=!0;try{const s=await M("/api/user/verify-code",{body:{email:v.value.trim(),code:d.value.trim()}}),e=String((s==null?void 0:s.code)??"");if(e==="6007"){alert((s==null?void 0:s.message)||"驗證碼錯誤或已過期"),d.value="";return}if(!(e==="0004"||e==="200"||(s==null?void 0:s.data)===!0||/成功/.test((s==null?void 0:s.message)??"")||/成功/.test(String((s==null?void 0:s.data)??"")))){alert((s==null?void 0:s.message)||"驗證失敗");return}clearInterval(w),g.value=2}catch(s){alert(s.message||"驗證失敗，請稍後再試")}finally{r.value=!1}}}async function X(){var s;if(L.value){if(m.value!==y.value){alert("密碼與確認密碼不一致");return}r.value=!0;try{const e=await M("/api/user/register",{body:{userName:c.value.trim(),userPassword:m.value,email:v.value.trim()}}),i=(s=e==null?void 0:e.data)==null?void 0:s.token;if(i){localStorage.setItem("userToken",i),D.setIsAuthenticated(!0);const S=localStorage.getItem("redirectAfterLogin");if(S)localStorage.removeItem("redirectAfterLogin"),V.push(S);else{const h=localStorage.getItem("userRole")||"consumer";V.push(h==="farmer"?"/farmer/crop-dashboard":"/veggie")}return}if(String((e==null?void 0:e.code)??"")==="6003"){alert((e==null?void 0:e.message)||"註冊成功"),V.push("/member/login");return}alert((e==null?void 0:e.message)||"註冊結果不明，請稍後再試")}catch(e){alert(e.message||"註冊失敗，請稍後再試")}finally{r.value=!1}}}return(s,e)=>{const i=se("RouterLink");return l(),a("div",ue,[t("div",de,[e[19]||(e[19]=t("div",{class:"logo-section"},[t("img",{src:ie,alt:"Logo",class:"logo"}),t("h1",null,"登入食價登錄FRESHLOG")],-1)),t("div",ce,[E(i,{to:"/member/login",class:"tab"},{default:N(()=>e[9]||(e[9]=[_("登入")])),_:1}),e[10]||(e[10]=t("button",{class:"tab active"},"註冊",-1))]),t("form",{onSubmit:e[8]||(e[8]=oe(o=>g.value===1?W():X(),["prevent"])),class:"form"},[g.value===1?(l(),a("div",ve,[t("div",me,[t("div",pe,[f(t("input",{type:"email","onUpdate:modelValue":e[0]||(e[0]=o=>v.value=o),placeholder:"請輸入電子郵件"},null,512),[[A,v.value]])]),v.value.trim()!==""&&!I.value?(l(),a("p",ge," ！請輸入正確的電子郵件格式 ")):p("",!0)]),t("div",fe,[R.value?p("",!0):(l(),a("button",{key:0,type:"button",class:"submit-btn",onClick:T,disabled:!J.value}," 獲取驗證碼 ",8,_e))]),R.value?(l(),a(ae,{key:0},[t("p",we,"請於 "+le(b.value)+" 秒內輸入驗證碼",1),t("div",ye,[t("div",he,[f(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=o=>d.value=o),placeholder:"請輸入6位數驗證碼"},null,512),[[A,d.value]])]),t("button",{type:"button",class:"resend-btn",onClick:Q,disabled:!Z.value},"重新寄送",8,be)]),d.value.trim()!==""&&!H.value?(l(),a("p",ke," 驗證碼須為6位數 ")):p("",!0),t("div",xe,[t("label",Se,[f(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=o=>P.value=o)},null,512),[[ne,P.value]]),e[11]||(e[11]=_(" 我同意條款和條件 "))])]),t("div",Ce,[t("button",{type:"submit",class:"submit-btn",disabled:!U.value}," 確認 ",8,Ve)])],64)):p("",!0)])):(l(),a("div",Pe,[t("div",Re,[t("div",Ie,[f(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),placeholder:"帳號"},null,512),[[A,c.value]])]),c.value.trim()!==""&&c.value.trim().length<8?(l(),a("p",Me," 帳號至少 8 個字元 ")):c.value.trim()!==""&&!$.test(c.value.trim())?(l(),a("p",Ae," 帳號只能使用英文字母或數字 ")):p("",!0)]),t("div",$e,[t("div",ze,[f(t("input",{type:k.value?"text":"password","onUpdate:modelValue":e[4]||(e[4]=o=>m.value=o),placeholder:"密碼（至少8位含英數）"},null,8,Be),[[j,m.value]]),t("span",{class:"toggle-password",onClick:e[5]||(e[5]=o=>k.value=!k.value)},[k.value?(l(),a("svg",Ue,e[12]||(e[12]=[t("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"},null,-1),t("circle",{cx:"12",cy:"12",r:"3"},null,-1)]))):(l(),a("svg",Le,e[13]||(e[13]=[t("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 20c-5.05 0-9.29-3.18-11-8a10.94 10.94 0 0 1 5.06-6.26M1 1l22 22"},null,-1)])))])]),m.value!==""&&!z.value?(l(),a("p",Te,e[14]||(e[14]=[_(" 密碼至少8位，且需包含英文及數字"),t("br",null,null,-1),_(" 註:可加上特殊符號加強密碼強度 ")]))):p("",!0)]),t("div",Ee,[t("div",Ne,[f(t("input",{type:x.value?"text":"password","onUpdate:modelValue":e[6]||(e[6]=o=>y.value=o),placeholder:"確認密碼"},null,8,je),[[j,y.value]]),t("span",{class:"toggle-password",onClick:e[7]||(e[7]=o=>x.value=!x.value)},[x.value?(l(),a("svg",De,e[15]||(e[15]=[t("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"},null,-1),t("circle",{cx:"12",cy:"12",r:"3"},null,-1)]))):(l(),a("svg",qe,e[16]||(e[16]=[t("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 20c-5.05 0-9.29-3.18-11-8a10.94 10.94 0 0 1 5.06-6.26M1 1l22 22"},null,-1)])))])]),y.value!==""&&!B.value?(l(),a("p",Fe," 確認密碼需與密碼相同 ")):p("",!0)]),t("div",He,[t("button",{type:"submit",class:"submit-btn",disabled:!L.value}," 註冊 ",8,Oe)])]))],32),t("p",Ge,[e[18]||(e[18]=_(" 已有帳號了？")),E(i,{to:"/member/login"},{default:N(()=>e[17]||(e[17]=[_("登入蔬界 ✏️")])),_:1})])])])}}},We=Y(Je,[["__scopeId","data-v-bf363edd"]]);export{We as default};
