import{_ as K,r as i,h as u,J as Z,c as a,o as n,b as s,E as Q,k as c,a as d,G as S,L as h,t as W,H as I,y as T,d as X}from"./index-DmGRutL1.js";import{_ as Y}from"./logo-CqOTfE4X.js";const ee={class:"auth-page"},te={class:"auth-card"},se={class:"form-group"},oe={class:"input-container"},ae={key:0,class:"input-error"},ne=["disabled"],le={class:"form-group"},re={key:0,class:"hint-text timer"},ie={class:"form-group horizontal-group"},ue={class:"input-container"},ce=["disabled"],de={key:1,class:"input-error"},ve=["disabled"],pe={class:"form-group"},me={class:"input-container password-input-container"},we=["type"],_e={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},ge={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},ye={key:0,class:"input-error"},fe={class:"form-group"},he={class:"input-container password-input-container"},be=["type"],ke={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},xe={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Ce={key:0,class:"input-error"},Pe=["disabled"],Ve={__name:"ForgotPassword",setup($e){const U=X(),E="",l=i(1),r=i(""),v=i(""),p=i(""),w=i(""),q=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,b=u(()=>q.test(r.value.trim())),P=u(()=>v.value.trim().length===6),_=i(!1),g=i(!1),A=/^(?=.*[A-Za-z])(?=.*\d).{8,}$/,V=u(()=>A.test(p.value)),$=u(()=>w.value===p.value),y=i(60);let m=null;const N=u(()=>b.value),M=u(()=>P.value),R=u(()=>l.value===2),O=u(()=>V.value&&$.value);function B(){y.value=300,clearInterval(m),m=setInterval(()=>{y.value>0?y.value--:clearInterval(m)},1e3)}Z(()=>clearInterval(m));async function z(e,t,{query:o,body:x}={}){const J=o?`?${new URLSearchParams(o).toString()}`:"",G=`${E}${t}${J}`,C=await fetch(G,{method:e,headers:x?{"Content-Type":"application/json"}:void 0,body:x?JSON.stringify(x):void 0}),f=await C.json().catch(()=>({}));if(!C.ok)throw new Error((f==null?void 0:f.message)||`HTTP ${C.status}`);return f}const k=(e,t)=>z("POST",e,t),D=(e,t)=>z("PUT",e,t);async function F(){if(b.value)try{await k("/api/user/send-code",{query:{email:r.value.trim()}}),l.value=2,B()}catch(e){console.error(e),alert(e.message||"驗證碼寄送失敗，請稍後再試。")}}async function L(){try{await k("/api/user/send-code",{query:{email:r.value.trim()}}),v.value="",B()}catch(e){console.error(e),alert(e.message||"重新寄送失敗，請稍後再試。")}}async function j(){if(M.value)try{const e=await k("/api/user/verify-code",{body:{email:r.value.trim(),code:v.value.trim()}});if(`${(e==null?void 0:e.code)??""}`==="6007"){alert((e==null?void 0:e.message)||"驗證碼錯誤或已過期");return}clearInterval(m),l.value=3}catch(e){console.error(e),alert(e.message||"驗證失敗，請稍後再試。")}}async function H(){try{const e=await D("/api/user/forgetPassword",{query:{email:r.value.trim(),newPassword:p.value}}),t=`${(e==null?void 0:e.code)??""}`,o=t==="6100"||/^2/.test(t)||(e==null?void 0:e.code)==="OK"||(e==null?void 0:e.success)===!0||(e==null?void 0:e.data)===!0;if(t==="404"){alert((e==null?void 0:e.message)||"資料不存在或信箱未註冊");return}if(!o){alert((e==null?void 0:e.message)||"重設失敗，請稍後再試。");return}alert("密碼重設成功！請重新登入。"),U.push("/member/login")}catch(e){console.error(e),alert(e.message||"重設失敗，請稍後再試。")}}return(e,t)=>(n(),a("div",ee,[s("div",te,[t[11]||(t[11]=s("div",{class:"logo-section"},[s("img",{src:Y,alt:"Logo",class:"logo"}),s("h1",null,"忘記密碼"),s("p",{class:"subtitle"}," 輸入註冊信箱，我們會寄送驗證碼給您 ")],-1)),s("form",{onSubmit:Q(H,["prevent"]),class:"form"},[s("div",se,[s("div",oe,[c(s("input",{type:"email","onUpdate:modelValue":t[0]||(t[0]=o=>r.value=o),placeholder:"請輸入註冊Email"},null,512),[[S,r.value]])]),r.value.trim()!==""&&!b.value?(n(),a("p",ae," ！請輸入正確的電子郵件格式 ")):d("",!0),l.value===1?(n(),a("button",{key:1,type:"button",class:"submit-btn",onClick:F,disabled:!N.value},"獲取驗證碼",8,ne)):d("",!0)]),c(s("div",le,[l.value===2?(n(),a("p",re," 請於 "+W(y.value)+" 秒內輸入驗證碼 ",1)):d("",!0),s("div",ie,[s("div",ue,[c(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=o=>v.value=o),placeholder:"請輸入6位數驗證碼"},null,512),[[S,v.value]])]),s("button",{type:"button",class:"resend-btn",onClick:L,disabled:!R.value}," 重新寄送 ",8,ce)]),v.value.trim()!==""&&!P.value?(n(),a("p",de," 驗證碼須為6位數 ")):d("",!0),l.value===2?(n(),a("button",{key:2,type:"button",class:"submit-btn",onClick:j,disabled:!M.value}," 確認 ",8,ve)):d("",!0)],512),[[h,l.value>=2]]),c(s("div",pe,[s("div",me,[c(s("input",{type:_.value?"text":"password","onUpdate:modelValue":t[2]||(t[2]=o=>p.value=o),placeholder:"密碼（至少8位含英數）"},null,8,we),[[I,p.value]]),s("span",{class:"toggle-password",onClick:t[3]||(t[3]=o=>_.value=!_.value)},[_.value?(n(),a("svg",_e,t[6]||(t[6]=[s("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"},null,-1),s("circle",{cx:"12",cy:"12",r:"3"},null,-1)]))):(n(),a("svg",ge,t[7]||(t[7]=[s("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 20c-5.05 0-9.29-3.18-11-8a10.94 10.94 0 0 1 5.06-6.26M1 1l22 22"},null,-1)])))])]),p.value.trim()!==""&&!V.value?(n(),a("p",ye,t[8]||(t[8]=[T(" 密碼至少8位，且需包含英文及數字"),s("br",null,null,-1),T(" 註:可加上特殊符號加強密碼強度 ")]))):d("",!0)],512),[[h,l.value>=3]]),c(s("div",fe,[s("div",he,[c(s("input",{type:g.value?"text":"password","onUpdate:modelValue":t[4]||(t[4]=o=>w.value=o),placeholder:"確認密碼"},null,8,be),[[I,w.value]]),s("span",{class:"toggle-password",onClick:t[5]||(t[5]=o=>g.value=!g.value)},[g.value?(n(),a("svg",ke,t[9]||(t[9]=[s("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"},null,-1),s("circle",{cx:"12",cy:"12",r:"3"},null,-1)]))):(n(),a("svg",xe,t[10]||(t[10]=[s("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 20c-5.05 0-9.29-3.18-11-8a10.94 10.94 0 0 1 5.06-6.26M1 1l22 22"},null,-1)])))])]),w.value!==""&&!$.value?(n(),a("p",Ce," 確認密碼需與密碼相同 ")):d("",!0)],512),[[h,l.value>=3]]),c(s("button",{type:"submit",class:"submit-btn",disabled:!O.value}," 確認修改 ",8,Pe),[[h,l.value===3]])],32)])]))}},ze=K(Ve,[["__scopeId","data-v-6f407d09"]]);export{ze as default};
