import{_ as j,r as b,h as A,w as E,c as g,o as p,b as t,k as F,K as w,t as y,G as q,n as ie,F as R,e as P,f as T,a as V,M as B,i as le,j as U,m as re,d as ce}from"./index-DZTT0LQi.js";import{a as de}from"./index-t--hEgTQ.js";const N=de.create({baseURL:"https://freshlog-api.ttshow.tw/api",timeout:3e4,headers:{"Content-Type":"application/json"}});N.interceptors.request.use(o=>{var m;return console.log("📤 API Request:",(m=o.method)==null?void 0:m.toUpperCase(),o.baseURL+o.url),o});N.interceptors.response.use(o=>(console.log("📥 API Response:",o.status,o.config.baseURL+o.config.url),o),o=>{var m,r,a,d,u;return console.error("❌ API Error:",{status:(m=o.response)==null?void 0:m.status,url:((r=o.config)==null?void 0:r.baseURL)+((a=o.config)==null?void 0:a.url),message:((u=(d=o.response)==null?void 0:d.data)==null?void 0:u.message)||o.message}),Promise.reject(o)});const I={findFoodsList:async(o={})=>{var m,r;try{console.log("🌐 呼叫API- findFoodsList",o);const a={category:o.category||"",subCategory:o.subCategory||"",name:o.name||"",nameEn:o.nameEn||"",priceMin:o.priceMin||0,priceMax:o.priceMax||999999,tag:o.tag||"",sort:o.sort||"price_desc"};console.log("📤 查詢參數:",a);const d=await N.post("/food/findFoodsList",a,{headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:15e3});if(console.log("✅ API 回應:",d.data),((m=d.data)==null?void 0:m.code)==="0000")return d.data.data&&d.data.data.length>0?(d.data.data.forEach(u=>{console.log(`📊 ${u.name} 圖片資料:`,{image:u.image,hasImage:!!u.image,imageType:typeof u.image})}),console.log("🎉 成功取得真實資料:",d.data.data.length,"筆"),d.data):(console.log("⚠️ API 回傳空資料，使用 Mock 資料"),K());throw new Error(`API 回應錯誤: ${((r=d.data)==null?void 0:r.message)||"未知錯誤"}`)}catch(a){return console.error("❌ API 呼叫失敗:",a.message),console.log("🎭 使用 Mock 資料展示功能"),K()}},findFoodData:async o=>{var m,r;try{console.log("🌐 取得食品詳情:",o);const a=await N.get("/food/findFoodData",{params:{foodId:o}});return console.log("✅ 食品詳情完整回應:",a.data),(r=(m=a.data)==null?void 0:m.data)!=null&&r.image?console.log("🖼️ 圖片資料:",{image:a.data.data.image,imageLength:a.data.data.image.length,isBase64:a.data.data.image.startsWith("data:image/"),isUrl:a.data.data.image.startsWith("http"),isPath:a.data.data.image.startsWith("/")}):console.log("❌ 沒有找到圖片資料"),a.data}catch(a){return console.warn("⚠️ 食品詳情失敗，使用預設:",a.message),{code:"0000",message:"Success (Mock)",data:{foodId:o,name:"測試食品",category:"蔬菜",price:50,tag:"當季/新鮮",description:"測試用食品資料",image:"/images/test-veggie.jpg",isRecommendation:!0}}}},getFoodSortEnums:async()=>{try{console.log("🌐 取得排序選項");const o=await N.get("/food/getFoodSortEnums");return console.log("✅ 排序選項成功:",o.data),o.data}catch(o){return console.warn("⚠️ 排序選項失敗，使用預設:",o.message),{code:"0000",message:"Success",data:[{code:"price_desc",label:"價格高到低"},{code:"price_asc",label:"價格低到高"},{code:"seasonal",label:"產季由近到遠"},{code:"name_asc",label:"名稱 A-Z"},{code:"name_desc",label:"名稱 Z-A"}]}}}};function K(){return{code:"0000",message:"搜尋成功 (Mock 資料)",data:[{foodId:"MOCK001",name:"測試高麗菜",category:"蔬菜",price:50,tag:"當季/新鮮/維生素C",description:"測試用新鮮高麗菜，富含維生素C",image:"/images/test-cabbage.jpg",isRecommendation:!0},{foodId:"MOCK002",name:"測試紅蘿蔔",category:"蔬菜",price:35,tag:"護眼/抗氧化/維生素A",description:"測試用有機紅蘿蔔，護眼明目",image:"/images/test-carrot.jpg",isRecommendation:!0},{foodId:"MOCK003",name:"測試菠菜",category:"葉菜類",price:45,tag:"補鐵/葉酸/營養",description:"測試用新鮮菠菜，鐵質豐富",image:"/images/test-spinach.jpg",isRecommendation:!0}]}}const ue={class:"filter-sidebar"},ge={class:"filter-section"},pe={class:"filter-options"},me={class:"checkbox-item"},ve={class:"checkbox-item"},fe={class:"checkbox-item"},ye={class:"checkbox-item"},he={class:"checkbox-item"},be={class:"filter-section"},_e={class:"price-range"},ke={class:"price-labels"},Ce={class:"slider-container"},xe={class:"filter-section nutrition-nav"},$e={class:"nutrition-tabs"},Fe=["onClick"],Me={__name:"Sidebar",props:{filters:{type:Object,required:!0},priceRange:{type:Array,required:!0},nutritionFilters:{type:Object,required:!0},activeNutritionTab:{type:String,default:""}},emits:["update-filters","update-price-range","update-nutrition-filters","update-nutrition-tab"],setup(o,{emit:m}){const r=o,a=m,d=b({...r.filters}),u=b([...r.priceRange]),f=b({...r.nutritionFilters}),S=[{id:"vitaminA",name:"維生素A"},{id:"vitaminC",name:"維生素C"},{id:"minerals",name:"膳食纖維"},{id:"potassium",name:"鉀"},{id:"calcium",name:"鈣"},{id:"iron",name:"鐵"},{id:"antioxidant",name:"抗氧化"}],h=A(()=>r.activeNutritionTab),k=A(()=>{const c=(u.value[0]-0)/200*100,$=(200-u.value[1])/200*100;return{left:c+"%",right:$+"%"}});E(()=>r.filters,v=>{d.value={...v}},{deep:!0}),E(()=>r.priceRange,v=>{u.value=[...v]}),E(()=>r.nutritionFilters,v=>{f.value={...v}},{deep:!0});const _=v=>{if(console.log("點擊營養標籤:",v,"當前選中:",h.value),h.value===v){console.log("清空選取狀態"),a("update-nutrition-tab","");const c={...f.value};Object.keys(c).forEach($=>{c[$]=!1}),f.value=c,a("update-nutrition-filters",c);return}console.log("設定新的選取狀態:",v),a("update-nutrition-tab",v);const n={...f.value};switch(Object.keys(n).forEach(c=>{n[c]=!1}),v){case"vitaminA":n.vitaminA=!0;break;case"vitaminC":n.vitaminC=!0;break;case"minerals":n.calcium=!0;break;case"potassium":n.iron=!0;break;case"calcium":n.calcium=!0;break;case"iron":n.iron=!0;break;case"antioxidant":n.antioxidant=!0;break}f.value=n,a("update-nutrition-filters",n)},C=()=>{a("update-filters",{...d.value})},O=()=>{u.value[0]>u.value[1]&&(u.value[0]=u.value[1])},M=()=>{a("update-price-range",[...u.value])};return(v,n)=>(p(),g("div",ue,[t("div",ge,[n[12]||(n[12]=t("h3",{class:"filter-title"},"特色篩選",-1)),t("div",pe,[t("label",me,[F(t("input",{type:"checkbox","onUpdate:modelValue":n[0]||(n[0]=c=>d.value.antioxidant=c),onChange:C},null,544),[[w,d.value.antioxidant]]),n[7]||(n[7]=t("span",{class:"checkbox-label"},"抗氧化",-1))]),t("label",ve,[F(t("input",{type:"checkbox","onUpdate:modelValue":n[1]||(n[1]=c=>d.value.supplement=c),onChange:C},null,544),[[w,d.value.supplement]]),n[8]||(n[8]=t("span",{class:"checkbox-label"},"補鈣佳品",-1))]),t("label",fe,[F(t("input",{type:"checkbox","onUpdate:modelValue":n[2]||(n[2]=c=>d.value.eyecare=c),onChange:C},null,544),[[w,d.value.eyecare]]),n[9]||(n[9]=t("span",{class:"checkbox-label"},"護眼明目",-1))]),t("label",ye,[F(t("input",{type:"checkbox","onUpdate:modelValue":n[3]||(n[3]=c=>d.value.energy=c),onChange:C},null,544),[[w,d.value.energy]]),n[10]||(n[10]=t("span",{class:"checkbox-label"},"運動能量",-1))]),t("label",he,[F(t("input",{type:"checkbox","onUpdate:modelValue":n[4]||(n[4]=c=>d.value.superFood=c),onChange:C},null,544),[[w,d.value.superFood]]),n[11]||(n[11]=t("span",{class:"checkbox-label"},"超級食物",-1))])])]),t("div",be,[n[14]||(n[14]=t("h3",{class:"filter-title"},"價格區間",-1)),t("div",_e,[t("div",ke,[t("span",null,"NT$"+y(u.value[0]),1),t("span",null,"NT$"+y(u.value[1]),1)]),t("div",Ce,[F(t("input",{type:"range",min:"0",max:"200","onUpdate:modelValue":n[5]||(n[5]=c=>u.value[0]=c),onInput:O},null,544),[[q,u.value[0],void 0,{number:!0}]]),F(t("input",{type:"range",min:"0",max:"200","onUpdate:modelValue":n[6]||(n[6]=c=>u.value[1]=c),onInput:O},null,544),[[q,u.value[1],void 0,{number:!0}]]),n[13]||(n[13]=t("div",{class:"slider-track"},null,-1)),t("div",{class:"slider-fill",style:ie(k.value)},null,4)])]),t("button",{class:"apply-btn",onClick:M},"套用篩選")]),t("div",xe,[n[15]||(n[15]=t("h3",{class:"filter-title"},"營養需求導航",-1)),t("div",$e,[(p(),g(R,null,P(S,c=>t("div",{key:c.id,class:T(["nutrition-tab",{active:h.value===c.id}]),onClick:$=>_(c.id)},y(c.name),11,Fe)),64))])])]))}},Ae=j(Me,[["__scopeId","data-v-944ca713"]]),Re={class:"food-category-section"},Pe={class:"category-center"},Se=["onClick"],we={class:"category-right"},Te={key:0,class:"sort-section"},Ne=["value"],Oe=["value"],Ue={__name:"CategoryTag",props:{categories:Array,activeCategory:String,sortOptions:Array,currentSort:String},emits:["set-category","sort-change"],setup(o){return(m,r)=>(p(),g("div",Re,[r[2]||(r[2]=t("div",{class:"category-left"},"食物分類",-1)),t("div",Pe,[(p(!0),g(R,null,P(o.categories,a=>(p(),g("button",{key:a.id,class:T(["category-btn",{active:o.activeCategory===a.id}]),onClick:d=>m.$emit("set-category",a.id)},y(a.name),11,Se))),128))]),t("div",we,[o.sortOptions&&o.sortOptions.length>0?(p(),g("div",Te,[r[1]||(r[1]=t("span",null,"產季：",-1)),t("select",{value:o.currentSort,onChange:r[0]||(r[0]=a=>m.$emit("sort-change",a.target.value)),class:"sort-select"},[(p(!0),g(R,null,P(o.sortOptions,a=>(p(),g("option",{key:a.value||a.code,value:a.value||a.code},y(a.label),9,Oe))),128))],40,Ne)])):V("",!0)])]))}},je=j(Ue,[["__scopeId","data-v-2871a1d0"]]),De={class:"market-insight"},Ee={class:"insight-content"},Ie={__name:"MarketSight",props:{insightText:{type:String,default:"根據最近市場趨勢，紅蘿蔔價格已連續三週下降，預計未來一週將回穩。建議現在是採購紅蘿蔔的好時機。"}},setup(o){return(m,r)=>(p(),g("div",De,[r[0]||(r[0]=t("div",{class:"insight-header"},[t("span",{class:"insight-icon"},"💡"),t("h3",null,"AI 市場洞察")],-1)),t("p",Ee,y(o.insightText),1)]))}},Le=j(Ie,[["__scopeId","data-v-4f230a23"]]),Ve={class:"ai-recommendation"},qe={class:"main-container"},Be={class:"sidebar-container"},Ke={class:"main-content"},We={key:0,class:"loading-container"},ze={key:1,class:"recipe-grid"},Ze={class:"image-container"},Ge=["src","alt"],Je={class:"card-content"},He={class:"dish-name"},Qe={class:"dish-description"},Xe={class:"nutrition-tags"},Ye={class:"price-section"},et={class:"price-info"},tt={class:"price"},at=["onClick"],st={key:2,class:"no-data"},nt={key:3,class:"pagination"},ot=["disabled"],it={class:"page-numbers"},lt=["onClick"],rt=["disabled"],L=6,ct={__name:"AiRecommendation",setup(o){const m=ce(),r=b("all"),a=b(1),d=b(!0),u=b("seasonal"),f=b([]),S=b([]),h=B({antioxidant:!1,supplement:!1,eyecare:!1,energy:!1,superFood:!1}),k=b([0,200]),_=B({vitaminA:!1,vitaminC:!1,calcium:!1,iron:!1,antioxidant:!1}),C=b(""),O=[{id:"all",name:"全部"},{id:"agricultural",name:"農產品"},{id:"vegetable",name:"蔬菜"},{id:"fruit",name:"水果"},{id:"leafy",name:"葉菜類"},{id:"root",name:"根莖類"},{id:"other",name:"其他"}],M=async()=>{d.value=!0;try{console.log("🔄 開始載入資料...");try{const i=await I.getFoodSortEnums();i&&i.data&&(S.value=i.data,console.log("✅ 排序選項載入成功:",S.value.length,"個選項"))}catch(i){console.warn("⚠️ 排序選項載入失敗:",i)}const e={category:r.value==="all"?"":v(r.value),subCategory:"",name:"",nameEn:"",priceMin:Math.min(k.value[0],k.value[1]),priceMax:Math.max(k.value[0],k.value[1]),tag:"",sort:u.value};console.log("📤 修正後的查詢參數:",e),console.log("🎯 當前分類:",r.value,"→",e.category);const s=await I.findFoodsList(e);if(s&&s.code==="0000"&&s.data){f.value=s.data.map(l=>({id:l.foodId,name:l.name,price:l.price||50,type:l.category,ingredients:l.tag?l.tag.split("/").filter(x=>x.trim()):["新鮮","營養"],description:l.description||`新鮮的${l.name}，營養豐富`,image:l.image,lastModifyDate:l.lastModifyDate,isRecommendation:l.isRecommendation,_originalData:l})),console.log("✅ 食物列表載入成功:",f.value.length,"個項目");const i={};f.value.forEach(l=>{i[l.type]=(i[l.type]||0)+1}),console.log("📊 資料分類統計:",i)}else console.warn("⚠️ 食物列表回應格式異常:",s),f.value=[]}catch(e){console.error("❌ 載入資料失敗:",e),f.value=[]}finally{d.value=!1,console.log("🏁 資料載入完成，總共",f.value.length,"個項目")}},v=e=>{const s={vegetable:"蔬菜",fruit:"水果",leafy:"葉菜類",root:"根莖類",other:"其他",agricultural:"農產品"};return console.log("🔄 分類對應:",e,"→",s[e]||e),s[e]||e},n=A(()=>{let e=[...f.value];return h.antioxidant&&(e=e.filter(s=>s.ingredients.some(i=>i.includes("抗氧化")))),h.supplement&&(e=e.filter(s=>s.ingredients.some(i=>i.includes("補鈣")||i.includes("鈣")))),h.eyecare&&(e=e.filter(s=>s.ingredients.some(i=>i.includes("護眼")||i.includes("維生素A")))),h.energy&&(e=e.filter(s=>s.ingredients.some(i=>i.includes("能量")||i.includes("營養")))),h.superFood&&(e=e.filter(s=>s.ingredients.some(i=>i.includes("超級")))),_.vitaminA&&(e=e.filter(s=>s.ingredients.some(i=>i.includes("維生素A")))),_.vitaminC&&(e=e.filter(s=>s.ingredients.some(i=>i.includes("維生素C")))),_.calcium&&(e=e.filter(s=>s.ingredients.some(i=>i.includes("鈣")))),_.iron&&(e=e.filter(s=>s.ingredients.some(i=>i.includes("鐵")))),_.antioxidant&&(e=e.filter(s=>s.ingredients.some(i=>i.includes("抗氧化")))),e}),c=A(()=>Math.ceil(n.value.length/L)),$=A(()=>{const e=(a.value-1)*L,s=e+L;return n.value.slice(e,s)}),W=A(()=>{const e=c.value,s=a.value,i=[];if(e<=5)for(let l=1;l<=e;l++)i.push(l);else{const l=Math.max(1,s-2),x=Math.min(e,l+4);for(let D=l;D<=x;D++)i.push(D)}return i}),z=e=>e.description||`產自台灣/當季/富含營養的${e.name}，新鮮美味，營養豐富。`,Z=e=>({蔬菜:"vegetable",葉菜類:"leafy",醃菜品:"pickled",根莖類:"root",水果:"fruit"})[e]||"vegetable",G=()=>Math.random()>.5?"price-up":"price-down",J=()=>Math.random()>.5?"▲1.5%":"▼0.2%",H=async e=>{console.log("📂 切換分類:",e),r.value=e,a.value=1,await M()},Q=async e=>{console.log("🔄 變更排序:",e),u.value=e,a.value=1,await M()},X=e=>{Object.assign(h,e),a.value=1},Y=async e=>{k.value=e,a.value=1,await M()},ee=e=>{Object.assign(_,e),a.value=1},te=e=>{C.value=e},ae=async e=>{try{const s=await I.findFoodData(e);s&&s.code==="8000"&&s.data&&localStorage.setItem(`recipe_${e}`,JSON.stringify(s.data))}catch(s){console.error("載入食譜詳情失敗:",s)}m.push(`/ai-recommendation/${e}`)},se=()=>{a.value>1&&a.value--},ne=()=>{a.value<c.value&&a.value++},oe=e=>{a.value=e};return le(()=>{M()}),(e,s)=>{const i=re("Footer");return p(),g("div",Ve,[t("div",qe,[t("div",Be,[U(Ae,{filters:h,priceRange:k.value,nutritionFilters:_,activeNutritionTab:C.value,onUpdateFilters:X,onUpdatePriceRange:Y,onUpdateNutritionFilters:ee,onUpdateNutritionTab:te},null,8,["filters","priceRange","nutritionFilters","activeNutritionTab"])]),t("div",Ke,[U(je,{categories:O,activeCategory:r.value,sortOptions:S.value,currentSort:u.value,onSetCategory:H,onSortChange:Q},null,8,["activeCategory","sortOptions","currentSort"]),U(Le),d.value?(p(),g("div",We,s[0]||(s[0]=[t("p",null,"🔄 載入中...",-1)]))):(p(),g("div",ze,[(p(!0),g(R,null,P($.value,l=>(p(),g("div",{class:"recipe-card",key:l.id},[t("div",Ze,[t("img",{src:e.$img(l.image),alt:l.name,class:"dish-image"},null,8,Ge),s[1]||(s[1]=t("div",{class:"rating-badge"},"★★★",-1)),s[2]||(s[2]=t("div",{class:"track-status"},[t("span",{class:"track-icon"},"📍"),t("span",null,"追蹤狀態")],-1))]),t("div",Je,[t("h3",He,y(l.name),1),t("div",{class:T(["category-tag",Z(l.type)])},y(l.type),3),t("div",Qe,y(z(l)),1),t("div",Xe,[(p(!0),g(R,null,P(l.ingredients.slice(0,2),x=>(p(),g("span",{key:x,class:"nutrition-tag"},y(x),1))),128))]),t("div",Ye,[t("div",et,[t("span",tt,"NT$"+y(l.price)+"/台斤",1),t("span",{class:T(["price-change",G()])},y(J()),3)]),t("button",{class:"detail-btn",onClick:x=>ae(l.id)}," 詳細資訊 ",8,at)])])]))),128))])),!d.value&&$.value.length===0?(p(),g("div",st,s[3]||(s[3]=[t("p",null,"目前沒有符合條件的食譜",-1)]))):V("",!0),c.value>1?(p(),g("div",nt,[t("button",{class:"page-btn",disabled:a.value===1,onClick:se}," 上一頁 ",8,ot),t("div",it,[(p(!0),g(R,null,P(W.value,l=>(p(),g("button",{key:l,class:T(["page-number",{active:a.value===l}]),onClick:x=>oe(l)},y(l),11,lt))),128))]),t("button",{class:"page-btn",disabled:a.value===c.value,onClick:ne}," 下一頁 ",8,rt)])):V("",!0)])]),U(i)])}}},gt=j(ct,[["__scopeId","data-v-5d66e655"]]);export{gt as default};
