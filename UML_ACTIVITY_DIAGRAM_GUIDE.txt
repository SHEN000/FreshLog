FreshLog 消費者 UML 活動圖設計指南
====================================

本文件提供繪製 FreshLog 消費者活動圖的完整參考信息。

## 主要活動流程

### 流程 1: 瀏覽蔬菜並查看詳細資訊
開始
  ↓
進入首頁 (ConsumerHome)
  ↓
點擊進入蔬菜瀏覽 (/ai-recommendation)
  ↓
選擇篩選條件
  ├─ 分類篩選 (葉菜類/根莖類/雜糧類/其他)
  ├─ 價格範圍 (0-200元)
  ├─ 營養需求 (維生素A/C/鈣/鐵/抗氧化)
  └─ 特色篩選 (抗氧化/補鈣/護眼/能量/超級食物)
  ↓
輸入蔬菜名稱搜尋
  ├─ 檢測輸入語言 (中文 or 英文)
  └─ 防抖搜尋 (400ms延遲)
  ↓
選擇排序方式
  ├─ 產季由近到遠
  ├─ 價格高到低
  └─ 價格低到高
  ↓
查看篩選結果 (6項/頁)
  ├─ 瀏覽蔬菜卡片
  │   ├─ 查看圖片、評分、追蹤狀態
  │   ├─ 查看名稱、分類、描述
  │   ├─ 查看營養標籤、AI建議、好處
  │   └─ 查看價格和價格變化
  ├─ 分頁導航
  │   ├─ 上一頁/下一頁
  │   └─ 直接選擇頁碼
  └─ 點擊「詳細資訊」
    ↓
進入蔬菜詳細頁 (/veggie/:id)
  ├─ 查看蔬菜主要資訊
  ├─ 查看AI建議和營養資訊
  ├─ 查看價格趨勢圖
  ├─ 查看多市場價格對比
  ├─ 查看相似蔬菜對比
  ├─ 查看相關食譜推薦
  │   └─ 點擊食譜進入食譜詳細頁
  ├─ 查看保存貼士
  └─ 返回或繼續瀏覽
結束

決策點 (Decision Points):
- 是否應用篩選條件?
- 是否進行搜尋?
- 是否改變排序?
- 是否查看詳細資訊?
- 是否進入相關食譜?


### 流程 2: 查看食譜
開始
  ↓
進入首頁 (ConsumerHome)
  ↓
點擊「食譜推薦」
  ↓
進入食譜列表頁 (/recipes)
  ↓
設置篩選條件
  ├─ 烹調時間 (15分/30分/1小時)
  ├─ 難易度 (簡單/中等/困難)
  ├─ 特色 (素食/其他)
  └─ 分類 (湯品/蔬菜/甜點/沙拉/肉類/飯類)
  ↓
排序食譜
  ├─ 最新上架
  ├─ 烹調時間由短到長
  ├─ 烹調時間由長到短
  ├─ 難易度由易到難
  └─ 難易度由難到易
  ↓
搜尋食譜名稱 (可選)
  ↓
查看食譜卡片 (20項/頁)
  ├─ 查看圖片、名稱、描述
  ├─ 查看烹調時間、份量、難易度
  ├─ 分頁導航 (上一頁/下一頁/直接選擇)
  ├─ 查看AI推薦區塊
  └─ 點擊進入詳細頁
    ↓
進入食譜詳細頁 (/ai-recommendation/:id)
  ├─ 查看麵包屑導航
  ├─ 查看食譜頭部信息
  │   ├─ 名稱、描述、圖片
  │   ├─ 烹調時間、份量、難易度
  │   └─ 漸層背景色
  ├─ 查看主要食材價格和成本估算
  ├─ 查看完整食材列表
  ├─ 查看烹調步驟
  ├─ 查看營養資訊
  ├─ 查看當季推薦食材
  ├─ 查看替代食材建議
  ├─ 查看市場行情
  ├─ 查看相關食譜推薦
  │   └─ 點擊查看相關食譜
  └─ 返回或繼續瀏覽
結束

決策點:
- 是否應用篩選?
- 是否搜尋食譜?
- 是否改變排序?
- 是否查看詳細資訊?
- 是否查看相關食譜?


### 流程 3: 用戶登入和認證
開始
  ↓
選擇登入方式
  ├─ [帳號密碼登入]
  │   ↓
  │   進入登入頁 (/member/login)
  │   ↓
  │   輸入帳號
  │   ↓
  │   輸入密碼 (可切換顯示/隱藏)
  │   ↓
  │   輸入驗證碼
  │   ├─ 查看驗證碼圖片
  │   ├─ 點擊刷新驗證碼
  │   └─ 錯誤時重新加載
  │   ↓
  │   [可選] 選擇「保持登入狀態」
  │   ↓
  │   點擊「登入」按鈕
  │   ↓
  │   驗證帳號密碼驗證碼
  │   ├─ 成功? → 儲存token, userId, userName到localStorage
  │   │           ↓
  │   │           重定向到首頁或之前頁面
  │   │           ↓
  │   │           進入登入狀態
  │   └─ 失敗? → 顯示錯誤訊息 → 重新輸入
  │
  ├─ [Google登入]
  │   ↓
  │   點擊「Google登入」按鈕
  │   ↓
  │   跳轉至Google授權頁面
  │   ↓
  │   授權FreshLog存取帳號信息
  │   ↓
  │   Google回調並登入成功
  │   ↓
  │   儲存認證信息
  │
  └─ [還沒有帳號?]
      ↓
      點擊「快來加入」
      ↓
      進入註冊頁 (/member/register)
      ↓
      輸入帳號
      ↓
      輸入Email
      ↓
      輸入密碼
      ↓
      確認密碼
      ↓
      輸入驗證碼
      ↓
      勾選「同意服務條款」
      ↓
      點擊「註冊」
      ↓
      驗證信息
      ├─ 成功? → 帳號已建立 → 進入登入頁
      └─ 失敗? → 顯示錯誤 → 重新輸入
結束

決策點:
- 選擇登入方式 (帳號密碼 vs Google)?
- 是否已有帳號?
- 登入驗證成功?
- 是否需要重新設置密碼?


### 流程 4: 忘記密碼
開始
  ↓
進入登入頁 (/member/login)
  ↓
點擊「忘記密碼?」
  ↓
進入忘記密碼頁 (/member/forgot-password)
  ↓
輸入Email或帳號
  ↓
輸入驗證碼
  ├─ 查看驗證碼
  └─ 點擊刷新
  ↓
提交驗證
  ├─ 成功? → 發送重置密碼郵件
  │           ↓
  │           顯示確認訊息
  │           ↓
  │           進入郵件中的密碼重置連結
  │           ↓
  │           輸入新密碼
  │           ↓
  │           確認新密碼
  │           ↓
  │           提交新密碼
  │           ↓
  │           密碼已重置 → 返回登入頁
  └─ 失敗? → 顯示錯誤 → 重試
結束


### 流程 5: 個人資料管理 (需要登入)
開始
  ↓
檢查登入狀態
  ├─ 未登入? → 顯示「請先登入」 → 提供登入鏈接
  │           ↓
  │           跳轉至登入頁
  │
  └─ 已登入? → 進入個人資料頁 (/member/profile)
              ↓
              顯示側邊欄選單
              ├─ 用戶頭像
              ├─ 「個人資訊」標籤
              ├─ 「食譜收藏」標籤
              ├─ 「蔬菜收藏」標籤
              ├─ 「到價追蹤」標籤
              └─ 「登出」按鈕
              ↓
              選擇內容區域
              ├─ [個人資訊]
              │   ├─ 編輯姓名
              │   ├─ 編輯電話
              │   ├─ 編輯Email
              │   ├─ 編輯地址
              │   ├─ 編輯出生日期
              │   ├─ 編輯性別
              │   ├─ 編輯照片/頭像
              │   └─ 點擊「保存」更新信息
              │
              ├─ [食譜收藏]
              │   ├─ 查看已保存食譜列表
              │   ├─ 點擊食譜進入詳細頁
              │   └─ 移除收藏
              │
              ├─ [蔬菜收藏]
              │   ├─ 查看已收藏蔬菜列表
              │   ├─ 點擊蔬菜進入詳細頁
              │   └─ 移除收藏
              │
              └─ [到價追蹤]
                  ├─ 查看追蹤清單
                  ├─ 查看蔬菜名稱和目標價格
                  ├─ 編輯追蹤價格
                  ├─ 移除追蹤
                  └─ 接收價格變動通知
結束

決策點:
- 使用者是否登入?
- 選擇編輯哪個標籤?
- 是否確認保存修改?
- 是否移除收藏/追蹤?


### 流程 6: 追蹤和通知管理
開始
  ↓
進入個人資料頁
  ↓
選擇「我的追蹤」(/member/follows) 或 「追蹤設定」(/member/follow-setting)
  ├─ [我的追蹤]
  │   ├─ 查看追蹤的農民列表
  │   ├─ 查看追蹤的作物列表
  │   ├─ 取消追蹤 (移除農民/作物)
  │   └─ 點擊檢視詳情
  │
  └─ [追蹤設定]
      ├─ 設置「價格變動通知」開/關
      ├─ 設置「新作物上架通知」開/關
      ├─ 設置「新食譜推薦通知」開/關
      ├─ 設置「農民更新通知」開/關
      ├─ 設置價格門檻
      ├─ 選擇通知方式 (郵件/應用推送)
      └─ 點擊「保存設定」
結束

決策點:
- 查看追蹤還是設定通知?
- 是否修改通知設定?
- 是否移除追蹤?


## 各流程中的關鍵決策點

1. 瀏覽蔬菜流程:
   - [是否應用篩選?] → 是/否
   - [是否搜尋?] → 是/否
   - [是否改變排序?] → 是/否
   - [是否查看詳細?] → 是/否
   - [是否查看相關食譜?] → 是/否

2. 食譜流程:
   - [是否設置篩選?] → 是/否
   - [是否搜尋食譜?] → 是/否
   - [是否查看詳細?] → 是/否
   - [是否查看相關?] → 是/否

3. 認證流程:
   - [登入方式?] → 帳號密碼/Google
   - [驗證成功?] → 是/否
   - [已有帳號?] → 是/否

4. 個人資料流程:
   - [是否登入?] → 是/否
   - [編輯哪項?] → 個人資訊/收藏/追蹤
   - [確認保存?] → 是/否


## 活動圖中的同步柵欄 (Fork/Join Bars)

### 並行活動
首頁加載時並行:
┌─────────────────────────────────┐
│ 加載品牌卡片 / 市場行情 / 農業指數 / 食譜 / 營養 / 食安 │
└─────────────────────────────────┘
       ↓            ↓           ↓
    完成       等待全部      合併
               加載完成

蔬菜詳細頁並行加載:
┌────────────────────────────────────────────┐
│ 加載主要資訊 / AI建議 / 營養資訊 / 價格趨勢 /  │
│ 市場對比 / 相似蔬菜 / 食譜推薦 / 保存貼士   │
└────────────────────────────────────────────┘
        ↓                ↓                ↓
     開始              等待全部         完成
                     數據加載


## 狀態機 (State Machine) 轉換

用戶狀態:
未登入 ──[登入成功]──→ 已登入
   ↑                      ↓
   └───[登出]─────────────┘

功能可用性:
[未登入]
  可用: 首頁、蔬菜瀏覽、蔬菜詳情、食譜、食譜詳情
  不可用: 個人資料、收藏、追蹤設定、通知

[已登入]
  可用: 所有功能
        + 保存收藏
        + 設置追蹤
        + 接收通知


## 異常處理 (Exception Handling)

1. 網絡連接失敗
   - 顯示「連接失敗」提示
   - 提供「重試」按鈕

2. 驗證碼加載失敗
   - 顯示「驗證碼加載失敗」
   - 提供「點擊重新加載」提示

3. 登入驗證失敗
   - 顯示「帳號或密碼錯誤」
   - 提供重新輸入機會

4. API 資料為空
   - 顯示「目前沒有符合條件的結果」
   - 提供「重置篩選」選項

5. 未授權訪問受保護路徑
   - 重定向到登入頁
   - 記錄原始頁面用於登入後重定向


## 對象和參與者 (Actors & Objects)

主要參與者:
- 消費者 (Consumer)
- 系統 (System/Backend)
- 資料庫 (Database)
- 外部服務 (Google OAuth, Email Service)

對象:
- 蔬菜對象
- 食譜對象
- 用戶對象
- 追蹤記錄
- 收藏記錄

